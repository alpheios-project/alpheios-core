language: node_js
node_js:
  - 13.2
cache: npm
install:
  - npm run set-node-build-deps
  - npm run bootstrap
script:
  - npm run test-ci
before_deploy:
  - echo "//registry.npmjs.org/:_authToken=\${NPM_TOKEN}" >> $HOME/.npmrc 2> /dev/null
deploy:
  - provider: script
    script: "npx lerna publish from-package --yes --dist-tag dev"
    on:
      all_branches: true
      tags: on
      condition: $TRAVIS_TAG =~ ^v[0-9]+.[0-9]+.[0-9]+-dev
  - provider: script
    script: "npx lerna publish from-package --yes --dist-tag qa"
    on:
      all_branches: true
      tags: on
      condition: $TRAVIS_TAG =~ ^v[0-9]+.[0-9]+.[0-9]+-qa
  - provider: script
    script: "npx lerna publish from-package --yes --dist-tag qa-ft"
    on:
      all_branches: true
      tags: on
      condition: $TRAVIS_TAG =~ ^v[0-9]+.[0-9]+.[0-9]+-qa-ft
  - provider: script
    script: "npx lerna publish from-package --yes --dist-tag latest"
    on:
      branch: production
  - provider: releases
    api_key:
      secure: RSCtr6AeKz3YEaeTG+YUScyl1NbNA/96yPcmEk2rssRtYLRcRXhd7Px352ODhPGW/gjncCi3fIndT5JPtq1u2CLsSqYwSa50tGe188/WFLoxMVUAmhR3PeKtwokWYth1/zq4AbkPNqJEcQtd9qepqLtl/Qd6INSy+pEMGc+/jBhbE7HOlL+t4zgQlgBjjnDPnQHZ8HLNZM8Z5UiZfnaS3pf59FL1An+vtVCto6b8d2coxvK9XKg3ytLMrlfCVZh9J7g6cNYFJe52WAXWllylghJZqUq5AgocR9lV/YbXJE9yKnz5+PC1N6fmseyz+f3blBKD6QevX0tFLrLJOHBxzmUwP8gRx7s5hunJ7x+8eJ0+Gj7KNre5d9Kz8l/pfLNTJ0PBb7UIZRj5VEDvC6SBnfKhRv63eikjZMUMwANzrcglt6xYYDYqkSudNcudPfUrMOFFBbhNI84P2jLNYE6U8AJW9u0S4+6Z/v/AII3sOGHLJf3U0KoGe85mHWhEDpp0TNWGKdhCAabBlPNHOaWgEkuccjvHX00HTT9q0pOZX8AFPDAf9S7WUBdY4qisCBq1mr+HgDRqHFEVQLZqjZIDGcEq17JOT+vP1hZkCMhAJxNRJqkQGZ5Ci3Zfsj7AxrMXcNLr6erglX5/2dbJZuMThW5YlSzFqNEXzIPUc/BZZJo=
    on:
      repo: alpheios-project/alpheios-core
      all_branches: true
      tags: on
      condition: $TRAVIS_TAG =~ ^v[0-9]+.[0-9]+.[0-9]+