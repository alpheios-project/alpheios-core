!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e(require("alpheios-data-models"));else if("function"==typeof define&&define.amd)define(["alpheios-data-models"],e);else{var o="object"==typeof exports?e(require("alpheios-data-models")):e(t["alpheios-data-models"]);for(var r in o)("object"==typeof exports?exports:t)[r]=o[r]}}(window,function(t){return function(t){var e={};function o(r){if(e[r])return e[r].exports;var s=e[r]={i:r,l:!1,exports:{}};return t[r].call(s.exports,s,s.exports,o),s.l=!0,s.exports}return o.m=t,o.c=e,o.d=function(t,e,r){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},o.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(o.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)o.d(r,s,function(e){return t[e]}.bind(null,s));return r},o.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="",o(o.s=16)}([function(e,o){e.exports=t},function(t,e,o){},function(t,e,o){},function(t,e,o){},function(t,e,o){},function(t,e,o){},function(t,e){t.exports={render:function(){var t=this.$createElement,e=this._self._c||t;return e("svg",{attrs:{viewBox:"0 0 447.6 757.4"}},[e("path",{attrs:{d:"M-128.4 305.8c74.8 53.3 146.8 110.5 215.7 171.3 0 0 348.4-399.4 557.1-477.1l27 53S277.2 418 150.5 757.4l-374.3-378.7 95.4-72.9z"}})])},toString:function(){return"C:\\uds\\projects\\alpheios\\wordlist\\src\\icons\\check.svg"}}},function(t,e){t.exports={render:function(){var t=this.$createElement,e=this._self._c||t;return e("svg",{attrs:{viewBox:"0 0 900.5 900.5"}},[e("path",{attrs:{d:"M176.42 880.5c0 11.046 8.954 20 20 20h507.67c11.046 0 20-8.954 20-20V232.49H176.42V880.5zm386.33-537.73h75V778.8h-75V342.77zm-150 0h75V778.8h-75V342.77zm-150 0h75V778.8h-75V342.77zM618.82 91.911V20c0-11.046-8.954-20-20-20H301.67c-11.046 0-20 8.954-20 20v96.911h-139.8c-11.046 0-20 8.954-20 20v50.576c0 11.045 8.954 20 20 20h616.75c11.046 0 20-8.955 20-20v-50.576c0-11.046-8.954-20-20-20h-139.8V91.912zm-75 20.889H356.67V75.001h187.15v37.801z"}})])},toString:function(){return"C:\\uds\\projects\\alpheios\\wordlist\\src\\icons\\delete.svg"}}},function(t,e,o){},function(t,e){t.exports={render:function(){var t=this.$createElement,e=this._self._c||t;return e("svg",{attrs:{viewBox:"0 0 442 442"}},[e("path",{attrs:{d:"M171 336H70c-5.523 0-10 4.477-10 10s4.477 10 10 10h101c5.523 0 10-4.477 10-10s-4.477-10-10-10zM322 336H221c-5.523 0-10 4.477-10 10s4.477 10 10 10h101c5.522 0 10-4.477 10-10s-4.478-10-10-10zM322 86H70c-5.523 0-10 4.477-10 10s4.477 10 10 10h252c5.522 0 10-4.477 10-10s-4.478-10-10-10zM322 136H221c-5.523 0-10 4.477-10 10s4.477 10 10 10h101c5.522 0 10-4.477 10-10s-4.478-10-10-10zM322 186H221c-5.523 0-10 4.477-10 10s4.477 10 10 10h101c5.522 0 10-4.477 10-10s-4.478-10-10-10zM322 236H221c-5.523 0-10 4.477-10 10s4.477 10 10 10h101c5.522 0 10-4.477 10-10s-4.478-10-10-10zM322 286H221c-5.523 0-10 4.477-10 10s4.477 10 10 10h101c5.522 0 10-4.477 10-10s-4.478-10-10-10zM171 286H70c-5.523 0-10 4.477-10 10s4.477 10 10 10h101c5.523 0 10-4.477 10-10s-4.477-10-10-10zM171 136H70c-5.523 0-10 4.477-10 10v101c0 5.523 4.477 10 10 10h101c5.523 0 10-4.477 10-10V146c0-5.523-4.477-10-10-10zm-10 101H80v-81h81v81z"}}),e("path",{attrs:{d:"M422 76h-30V46c0-11.028-8.972-20-20-20H20C8.972 26 0 34.972 0 46v320c0 27.57 22.43 50 50 50h342c27.57 0 50-22.43 50-50V96c0-11.028-8.972-20-20-20zm0 290c0 16.542-13.458 30-30 30H50c-16.542 0-30-13.458-30-30V46h352v305c0 13.785 11.215 25 25 25 5.522 0 10-4.477 10-10s-4.478-10-10-10c-2.757 0-5-2.243-5-5V96h30v270z"}})])},toString:function(){return"C:\\uds\\projects\\alpheios\\wordlist\\src\\icons\\text-quote.svg"}}},function(t,e){t.exports={render:function(){var t=this.$createElement,e=this._self._c||t;return e("svg",{attrs:{viewBox:"0 0 459 459"}},[e("path",{attrs:{d:"M178.5 140.25v-102L0 216.75l178.5 178.5V290.7c127.5 0 216.75 40.8 280.5 130.05-25.5-127.5-102-255-280.5-280.5z"}})])},toString:function(){return"C:\\uds\\projects\\alpheios\\wordlist\\src\\icons\\back.svg"}}},function(t,e,o){"use strict";var r=o(1);o.n(r).a},function(t,e,o){"use strict";var r=o(2);o.n(r).a},function(t,e,o){"use strict";var r=o(3);o.n(r).a},function(t,e,o){"use strict";var r=o(4);o.n(r).a},function(t,e,o){"use strict";var r=o(5);o.n(r).a},function(t,e,o){"use strict";o.r(e);var r=o(8),s=o.n(r),i=o(0);class wordlist_controller_WordlistController{constructor(t,e){this.wordLists={},this.availableLangs=t,e.TEXT_QUOTE_SELECTOR_RECEIVED.sub(this.onTextQuoteSelectorReceived.bind(this)),e.HOMONYM_READY.sub(this.onHomonymReady.bind(this)),e.DEFS_READY.sub(this.onDefinitionsReady.bind(this)),e.LEMMA_TRANSL_READY.sub(this.onLemmaTranslationsReady.bind(this))}async initLists(t){for(let e of this.availableLangs){let o=await t.query({dataType:"WordItem",params:{languageCode:e}});o.length>0&&(this.wordLists[e]=new i.WordList(e,o))}wordlist_controller_WordlistController.evt.WORDLIST_UPDATED.pub(this.wordLists)}getWordList(t,e=!0){if(e&&!this._wordListExist(t)){let e=new i.WordList(t,[]);this.wordLists[t]=e,wordlist_controller_WordlistController.evt.WORDLIST_CREATED.pub(e)}return this.wordLists[t]}removeWordList(t){this.wordLists[t];delete this.wordLists[t],wordlist_controller_WordlistController.evt.WORDLIST_DELETED.pub({dataType:"WordItem",params:{languageCode:t}}),wordlist_controller_WordlistController.evt.WORDLIST_UPDATED.pub(this.wordLists)}removeWordListItem(t,e){let o=this.getWordList(t,!1);if(o){let t=o.deleteWordItem(e);t&&wordlist_controller_WordlistController.evt.WORDITEM_DELETED.pub({dataObj:t})}}getWordListItem(t,e,o=!1){let r,s=this.getWordList(t,o);return s&&(r=s.getWordItem(e,o,wordlist_controller_WordlistController.evt.WORDITEM_UPDATED)),r}onHomonymReady(t){let e=this.getWordListItem(t.language,t.targetWord,!0);e.homonym=t,wordlist_controller_WordlistController.evt.WORDITEM_UPDATED.pub({dataObj:e,params:{segment:"shortHomonym"}}),wordlist_controller_WordlistController.evt.WORDLIST_UPDATED.pub(this.wordLists)}onDefinitionsReady(t){let e=this.getWordListItem(t.homonym.language,t.homonym.targetWord);e?(e.homonym=t.homonym,wordlist_controller_WordlistController.evt.WORDITEM_UPDATED.pub({dataObj:e,params:{segment:"fullHomonym"}})):console.error("Something went wrong: request to add definitions to non-existent item")}onLemmaTranslationsReady(t){let e=this.getWordListItem(t.language,t.targetWord);e?(e.homonym=t,wordlist_controller_WordlistController.evt.WORDITEM_UPDATED.pub({dataObj:e,params:{segment:"fullHomonym"}})):console.error("Something went wrong: request to add translations to non-existent item")}onTextQuoteSelectorReceived(t){let e=this.getWordListItem(t.languageCode,t.normalizedText,!0);e?(e.addContext([t]),wordlist_controller_WordlistController.evt.WORDITEM_UPDATED.pub({dataObj:e,params:{segment:"context"}}),wordlist_controller_WordlistController.evt.WORDLIST_UPDATED.pub(this.getWordList(e.languageCode))):console.error("Unable to create or retrieve worditem")}updateWordItemImportant(t,e,o){let r=this.getWordListItem(t,e,!1);r?(r.important=o,wordlist_controller_WordlistController.evt.WORDITEM_UPDATED.pub({dataObj:r,params:{segment:"common"}})):console.error("Something went wrong: request to set important flag on non-existent item")}updateAllImportant(t,e){this.getWordList(t,!1).values.forEach(t=>{t.important=e,wordlist_controller_WordlistController.evt.WORDITEM_UPDATED.pub({dataObj:t,params:{segment:"common"}})})}selectWordItem(t,e){let o=this.getWordListItem(t,e,!1);wordlist_controller_WordlistController.evt.WORDITEM_SELECTED.pub(o.homonym)}_wordListExist(t){return Object.keys(this.wordLists).includes(t)}}wordlist_controller_WordlistController.evt={WORDLIST_UPDATED:new i.PsEvent("Wordlist updated",wordlist_controller_WordlistController),WORDLIST_CREATED:new i.PsEvent("Wordlist created",wordlist_controller_WordlistController),WORDLIST_DELETED:new i.PsEvent("Wordlist deleted",wordlist_controller_WordlistController),WORDITEM_SELECTED:new i.PsEvent("WordItem selected",wordlist_controller_WordlistController),WORDITEM_UPDATED:new i.PsEvent("WordItem updated",wordlist_controller_WordlistController),WORDITEM_DELETED:new i.PsEvent("WordItem deleted",wordlist_controller_WordlistController)};var n=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",[t.showContext?t._e():o("div",{staticClass:"alpheios-wordlist"},t._l(t.languagesList,function(e,r){return o("div",{key:r,staticClass:"alpheios-wordlist-language"},[o("word-language",{attrs:{controller:t.wordlistC,languageCode:e,updated:t.updated},on:{showContexts:t.showContexts}})],1)}),0),t._v(" "),t.showContext?o("div",{staticClass:"alpheios-wordlist-contexts"},[o("word-context",{attrs:{worditem:t.showContextWordItem},on:{backToWordList:t.backToWordList}})],1):t._e()])};n._withStripped=!0;var a=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",[o("div",{staticClass:"alpheios-wordlist-commands"},[o("div",{staticClass:"alpheios-wordlist-language__title"},[t._v(t._s(t.languageName))]),t._v(" "),o("alph-tooltip",{attrs:{tooltipDirection:"top-left",tooltipText:t.l10n.getMsg("TOOLTIP_ALL_IMPORTANT")}},[o("div",{staticClass:"alpheios-wordlist-commands__item alpheios-wordlist-commands__item-all-important",on:{click:function(e){return t.makeAllImportant()}}},[o("check-icon")],1)]),t._v(" "),o("alph-tooltip",{attrs:{tooltipDirection:"top-left",tooltipText:t.l10n.getMsg("TOOLTIP_NO_IMPORTANT")}},[o("div",{staticClass:"alpheios-wordlist-commands__item alpheios-wordlist-commands__item-no-important",on:{click:function(e){return t.removeAllImportant()}}},[o("check-icon")],1)]),t._v(" "),o("alph-tooltip",{attrs:{tooltipDirection:"top-left",tooltipText:t.l10n.getMsg("TOOLTIP_REMOVE_ALL")}},[o("div",{staticClass:"alpheios-wordlist-commands__item alpheios-wordlist-commands__item-remove-all",on:{click:function(e){return t.deleteAll()}}},[o("delete-icon")],1)])],1),t._v(" "),t._l(t.wordItems,function(e){return o("div",{key:e.targetWord},[o("word-item",{attrs:{controller:t.controller,worditem:e,updated:t.updated},on:{changeImportant:t.changeImportant,deleteItem:t.deleteItem,showContexts:t.showContexts}})],1)})],2)};a._withStripped=!0;var l=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"alpheios-tooltip",style:t.additionalStyles},[t._t("default"),t._v(" "),t.tooltipText?o("span",{staticClass:"alpheios-tooltip__text",class:t.finalTooltipDirection},[t._v("\n    "+t._s(t.tooltipText)+"\n  ")]):t._e()],2)};function d(t,e,o,r,s,i,n,a){var l,d="function"==typeof t?t.options:t;if(e&&(d.render=e,d.staticRenderFns=o,d._compiled=!0),r&&(d.functional=!0),i&&(d._scopeId="data-v-"+i),n?(l=function(t){(t=t||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(t=__VUE_SSR_CONTEXT__),s&&s.call(this,t),t&&t._registeredComponents&&t._registeredComponents.add(n)},d._ssrRegister=l):s&&(l=a?function(){s.call(this,this.$root.$options.shadowRoot)}:s),l)if(d.functional){d._injectStyles=l;var c=d.render;d.render=function(t,e){return l.call(e),c(t,e)}}else{var u=d.beforeCreate;d.beforeCreate=u?[].concat(u,l):[l]}return{exports:t,options:d}}l._withStripped=!0;var c=d({name:"TooltipWrap",data:()=>({allowedTooltipClasses:["alpheios-tooltip__top","alpheios-tooltip__top-right","alpheios-tooltip__top-left","alpheios-tooltip__bottom","alpheios-tooltip__bottom-right","alpheios-tooltip__bottom-wide","alpheios-tooltip__bottom-narrow","alpheios-tooltip__bottom-narrow2","alpheios-tooltip__left","alpheios-tooltip__right"],defaultTooltipClass:"alpheios-tooltip__bottom"}),props:{tooltipText:{type:String,required:!0},tooltipDirection:{type:String,required:!1},additionalStyles:{type:Object,required:!1}},computed:{tooltipDirectionLC:function(){return this.tooltipDirection?this.tooltipDirection.toLowerCase():""},tooltipDirectionClass:function(){return"alpheios-tooltip__"+this.tooltipDirectionLC},finalTooltipDirection:function(){return this.allowedTooltipClasses.indexOf(this.tooltipDirectionClass)>-1?this.tooltipDirectionClass:this.defaultTooltipClass}}},l,[],!1,null,null,null);c.options.__file="vue-components/common-components/tooltip-wrap.vue";var u=c.exports,h=o(6),m=o.n(h),p=o(7),_=o.n(p),g=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"alpheios-wordlist-language__worditem",class:t.itemClasses},[o("alph-tooltip",{attrs:{tooltipDirection:"top-left",tooltipText:t.l10n.getMsg("TOOLTIP_CHANGE_IMPORTANT")}},[o("div",{staticClass:"alpheios-worditem__data alpheios-worditem__icon",on:{click:function(e){return t.changeImportant()}}},[o("check-icon")],1)]),t._v(" "),o("alph-tooltip",{attrs:{tooltipDirection:"top-left",tooltipText:t.l10n.getMsg("TOOLTIP_REMOVE")}},[o("div",{staticClass:"alpheios-worditem__data alpheios-worditem__icon alpheios-worditem__delete_icon",on:{click:function(e){return t.deleteItem()}}},[o("delete-icon")],1)]),t._v(" "),o("alph-tooltip",{class:{"alpheios_no_tq ":!t.worditem.hasTextQuoteSelectors},attrs:{tooltipDirection:"top-left",tooltipText:t.l10n.getMsg("TOOLTIP_TEXT_CONTEXT")}},[o("div",{staticClass:"alpheios-worditem__data alpheios-worditem__icon alpheios-worditem__delete_icon",on:{click:function(e){return t.showContexts()}}},[o("text-quote-icon")],1)]),t._v(" "),o("div",{staticClass:"alpheios-worditem__data alpheios-worditem__targetWord",on:{click:function(e){return t.selectWordItem()}}},[t._v(t._s(t.worditem.targetWord))]),t._v(" "),o("div",{staticClass:"alpheios-worditem__data alpheios-worditem__lemmasList"},[t._v(t._s(t.lemmasList))])],1)};g._withStripped=!0;var w=o(9),D=o.n(w),v={name:"WordItemBlock",inject:["l10n"],components:{checkIcon:m.a,deleteIcon:_.a,textQuoteIcon:D.a,alphTooltip:u},props:{controller:{type:Object,required:!0},worditem:{type:Object,required:!0},updated:{type:Number,required:!0}},data:()=>({important:!1}),mounted(){this.important=this.worditem.important,this.$parent.$on("eventChangeImportant",this.eventChangeImportant)},computed:{itemClasses(){return{"alpheios-wordlist-language__worditem__active":this.important,"alpheios-wordlist-language__worditem__current_session":this.worditem.currentSession}},lemmasList(){return this.updated?this.worditem.lemmasList:""}},methods:{changeImportant(){this.$emit("changeImportant",this.worditem.targetWord,!this.worditem.important),this.important=this.worditem.important},eventChangeImportant(){this.important=this.worditem.important},selectWordItem(){this.controller.selectWordItem(this.worditem.languageCode,this.worditem.targetWord)},deleteItem(){this.$emit("deleteItem",this.worditem.targetWord)},showContexts(){this.$emit("showContexts",this.worditem.targetWord)}}},I=(o(11),d(v,g,[],!1,null,null,null));I.options.__file="vue-components/word-item-panel.vue";var f=I.exports,b={name:"WordLanguagePanel",components:{checkIcon:m.a,deleteIcon:_.a,wordItem:f,alphTooltip:u},inject:["l10n"],props:{controller:{type:Object,required:!0},languageCode:{type:String,required:!0},updated:{type:Number,required:!0}},data:()=>({reloadList:1}),computed:{wordlist(){return this.controller.getWordList(this.languageCode)},wordItems(){return this.updated&&this.reloadList?this.wordlist.values:[]},languageName(){return this.languageCode}},methods:{async makeAllImportant(){await this.controller.updateAllImportant(this.languageCode,!0),this.$emit("eventChangeImportant")},async removeAllImportant(){await this.controller.updateAllImportant(this.languageCode,!1),this.$emit("eventChangeImportant")},async changeImportant(t,e){await this.controller.updateWordItemImportant(this.languageCode,t,e)},async deleteItem(t){await this.controller.removeWordListItem(this.languageCode,t),this.reloadList=this.reloadList+1},async deleteAll(){await this.controller.removeWordList(this.languageCode),this.reloadList=this.reloadList+1},showContexts(t){this.$emit("showContexts",t,this.languageCode)}}},y=(o(12),d(b,a,[],!1,null,null,null));y.options.__file="vue-components/word-language-panel.vue";var C=y.exports,x=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",[o("div",{staticClass:"alpheios-wordlist-commands"},[o("alph-tooltip",{attrs:{tooltipDirection:"top-left",tooltipText:t.l10n.getMsg("TOOLTIP_BACK")}},[o("div",{staticClass:"alpheios-wordlist-commands__item alpheios-wordlist-commands__item-back",on:{click:t.backToWordList}},[o("back-icon")],1)]),t._v(" "),o("div",{staticClass:"alpheios-wordlist-language__title"},[t._v(t._s(t.worditem.targetWord)+" ("+t._s(t.worditem.languageCode)+")")])],1),t._v(" "),t._l(t.sourcesList,function(e){return o("div",{staticClass:"alpheios-wordlists-tqs"},[o("word-tq-source",{attrs:{source:e,tqSelectors:t.formattedContext[e]}})],1)})],2)};x._withStripped=!0;var W=o(10),T=o.n(W),S=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"alpheios-wordlists-tq"},[o("a",{staticClass:"alpheios-wordlists-tq-title",attrs:{href:t.source}},[t._v(t._s(t.source))]),t._v(" "),t._l(t.tqSelectors,function(e){return o("div",{key:e.ID,staticClass:"alpheios-wordlists-tq-contextHTML-block"},[o("p",{staticClass:"alpheios-wordlists-tq-contextHTML",domProps:{innerHTML:t._s(e.contextHTML)}})])})],2)};S._withStripped=!0;var E={name:"WordTQSourceBlock",props:{source:{type:String,required:!0},tqSelectors:{type:Array,required:!0}},computed:{},methods:{}},L=(o(13),d(E,S,[],!1,null,null,null));L.options.__file="vue-components/word-tq-source-block.vue";var O=L.exports,M={name:"WordContextBlock",components:{backIcon:T.a,alphTooltip:u,wordTqSource:O},inject:["l10n"],props:{worditem:{type:Object,required:!0}},computed:{formattedContext(){return this.worditem.formattedContext},sourcesList(){return Object.keys(this.formattedContext)}},methods:{backToWordList(){this.$emit("backToWordList")}}},j=(o(14),d(M,x,[],!1,null,null,null));j.options.__file="vue-components/word-context-panel.vue";var R={name:"WordListPanel",components:{wordLanguage:C,wordContext:j.exports},props:{wordlistC:{type:Object,required:!0},updated:{type:Number,required:!0}},data:()=>({showContextWordItem:null}),computed:{languagesList(){return this.showContextWordItem=null,this.updated&&Object.keys(this.wordLists).length>0?Object.keys(this.wordLists):[]},wordLists(){return this.updated?this.wordlistC.wordLists:[]},showContext(){return Boolean(this.showContextWordItem)}},methods:{showContexts(t,e){this.showContextWordItem=this.wordLists[e].getWordItem(t)},backToWordList(){this.showContextWordItem=null}}},k=(o(15),d(R,n,[],!1,null,null,null));k.options.__file="vue-components/word-list-panel.vue";var A=k.exports;class worditem_indexeddb_driver_WordItemIndexedDbDriver{constructor(t){this.userId=t,this.storageMap={common:{objectStoreName:"WordListsCommon",serialize:this._serializeCommon.bind(this),delete:this._segmentDeleteQueryByID.bind(this)},context:{objectStoreName:"WordListsContext",serialize:this._serializeContext.bind(this),load:this._loadContext,delete:this._segmentDeleteQueryByWordItemID.bind(this)},shortHomonym:{objectStoreName:"WordListsHomonym",serialize:this._serializeHomonym.bind(this),load:this._loadHomonym,delete:this._segmentDeleteQueryByID.bind(this)},fullHomonym:{objectStoreName:"WordListsFullHomonym",serialize:this._serializeHomonymWithFullDefs.bind(this),load:this._loadHomonym,delete:this._segmentDeleteQueryByID.bind(this)}}}get dbName(){return"AlpheiosWordLists"}get dbVersion(){return 3}get segments(){return Object.keys(this.storageMap)}get objectStores(){return Object.keys(this.storageMap).map(t=>this.storageMap[t].objectStoreName)}get WordListsCommon(){return this._objectStoreTemplate()}get WordListsContext(){let t=this._objectStoreTemplate();return t.indexes.push({indexName:"wordItemID",keyPath:"wordItemID",unique:!1}),t}get WordListsHomonym(){return this._objectStoreTemplate()}get WordListsFullHomonym(){return this._objectStoreTemplate()}load(t){return t.currentSession=!1,new i.WordItem(t)}loadSegment(t,e,o){this.storageMap[t].load&&this.storageMap[t].load(e,o)}segmentQuery(t,e){let o=this._makeStorageID(e),r="context"===t?"wordItemID":"ID";return{objectStoreName:this.storageMap[t].objectStoreName,condition:{indexName:r,value:o,type:"only"}}}segmentDeleteQuery(t,e){return this.storageMap[t].delete(t,e)}_segmentDeleteQueryByID(t,e){let o=this._makeStorageID(e);return{objectStoreName:this.storageMap[t].objectStoreName,condition:{indexName:"ID",value:o,type:"only"}}}_segmentDeleteQueryByWordItemID(t,e){let o=this._makeStorageID(e);return{objectStoreName:this.storageMap[t].objectStoreName,condition:{indexName:"wordItemID",value:o,type:"only"}}}segmentDeleteManyQuery(t,e){if(e.languageCode){let o=this.userId+"-"+e.languageCode;return{objectStoreName:this.storageMap[t].objectStoreName,condition:{indexName:"listID",value:o,type:"only"}}}throw new Error("Invalid query parameters - missing languageCode")}updateSegmentQuery(t,e){let o=[],r=this.storageMap[t].serialize(e);return Array.isArray(r)?o=o.concat(r):o.push(r),{objectStoreName:this.storageMap[t].objectStoreName,dataItems:o}}listQuery(t){if(t.languageCode){let e=this.userId+"-"+t.languageCode;return{objectStoreName:this.storageMap.common.objectStoreName,condition:{indexName:"listID",value:e,type:"only"}}}throw new Error("Invalid query parameters - missing languageCode")}_loadHomonym(t,e){t.homonym=i.WordItem.readHomonym(e[0])}_loadContext(t,e){Array.isArray(e)||(e=[e]),t.context=i.WordItem.readContext(e)}_serializeCommon(t){return{ID:this._makeStorageID(t),listID:this.userId+"-"+t.languageCode,userID:this.userId,languageCode:t.languageCode,targetWord:t.targetWord,important:t.important,createdDT:worditem_indexeddb_driver_WordItemIndexedDbDriver.currentDate}}_serializeContext(t){let e=[],o=0,r=this._makeStorageID(t);for(let s of t.context){let i={ID:r+"-"+ ++o,listID:this.userId+"-"+t.languageCode,userID:this.userId,languageCode:t.languageCode,targetWord:t.targetWord,wordItemID:r,target:{source:s.source,selector:{type:"TextQuoteSelector",exact:s.text,prefix:s.prefix,suffix:s.suffix,contextHTML:s.contextHTML,languageCode:s.languageCode}},createdDT:worditem_indexeddb_driver_WordItemIndexedDbDriver.currentDate};e.push(i)}return e}_serializeHomonym(t,e=!1){let o=t.homonym&&t.homonym instanceof i.Homonym?t.homonym.convertToJSONObject(e):{};return{ID:this._makeStorageID(t),listID:this.userId+"-"+t.languageCode,userID:this.userId,languageCode:t.languageCode,targetWord:t.targetWord,homonym:o}}_serializeHomonymWithFullDefs(t){return this._serializeHomonym(t,!0)}_makeStorageID(t){return this.userId+"-"+t.languageCode+"-"+t.targetWord}_objectStoreTemplate(){return{keyPath:"ID",indexes:[{indexName:"ID",keyPath:"ID",unique:!0},{indexName:"listID",keyPath:"listID",unique:!1},{indexName:"userID",keyPath:"userID",unique:!1},{indexName:"languageCode",keyPath:"languageCode",unique:!1},{indexName:"targetWord",keyPath:"targetWord",unique:!1}]}}static get currentDate(){let t=new Date;return t.getFullYear()+"/"+(t.getMonth()+1<10?"0":"")+(t.getMonth()+1)+"/"+(t.getDate()<10?"0":"")+t.getDate()+" @ "+(t.getHours()<10?"0":"")+t.getHours()+":"+(t.getMinutes()<10?"0":"")+t.getMinutes()+":"+(t.getSeconds()<10?"0":"")+t.getSeconds()}}class IndexedDBAdapter{constructor(t){this.available=this._initIndexedDBNamespaces(),this.dbDriver=t,this.errors=[]}async create(t){try{let e,o=this.dbDriver.segments;for(let r of o)if(!(e=await this.update(t,{segment:r})))throw new Error(`Unknown problems with updating segment ${r}`);return e>0}catch(t){return void(t&&this.errors.push(t))}}async deleteMany(t){try{let e={};for(let o of this.dbDriver.segments){let r=this.dbDriver.segmentDeleteManyQuery(o,t),s=await this._deleteFromStore(r);e[o]=s}return e}catch(t){return void(t&&this.errors.push(t))}}async deleteOne(t){try{for(let e of this.dbDriver.segments){let o=this.dbDriver.segmentDeleteQuery(e,t);await this._deleteFromStore(o)}}catch(t){return void(t&&this.errors.push(t))}}async update(t,e){try{let o,r=[e.segment];0===r.length&&(r=this.dbDriver.segments);for(let e of r){let r=this.dbDriver.updateSegmentQuery(e,t);o=await this._set(r)}return o}catch(t){return void(t&&this.errors.push(t))}}async query(t){try{let e=this.dbDriver.listQuery(t),o=await this._getFromStore(e),r=[];if(o.length>0)for(let t of o){let e=this.dbDriver.load(t),o=this.dbDriver.segments;for(let t of o){let o=this.dbDriver.segmentQuery(t,e),r=await this._getFromStore(o);r.length>0&&this.dbDriver.loadSegment(t,e,r)}r.push(e)}return r}catch(t){return t&&this.errors.push(t),[]}}clear(){let t=this.indexedDB.open(this.dbDriver.dbName,this.dbDriver.dbVersion);t.onsuccess=(t=>{try{let e=t.target.result,o=this.dbDriver.objectStores;for(let t of o){let o=e.transaction([t],"readwrite").objectStore(t).clear();o.onsuccess=function(e){console.log(`store ${t} cleared`)},o.onerror=function(t){this.errors.push(t.target)}}}catch(t){this.errors.push(t)}}),t.onerror=(t=>{this.errors.push(t.target)})}_initIndexedDBNamespaces(){return this.indexedDB=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB,this.IDBTransaction=window.IDBTransaction||window.webkitIDBTransaction||window.msIDBTransaction||{READ_WRITE:"readwrite"},this.IDBKeyRange=window.IDBKeyRange||window.webkitIDBKeyRange||window.msIDBKeyRange,!!this.indexedDB||(console.warn("Your browser doesn't support a stable version of IndexedDB. Such and such feature will not be available."),!1)}_openDatabaseRequest(){let t=this.indexedDB.open(this.dbDriver.dbName,this.dbDriver.dbVersion);return t.onupgradeneeded=(t=>{const e=t.target.result,o=t.target.transaction;this._createObjectStores(e,o)}),t}_createObjectStores(t,e){try{this.dbDriver.objectStores.forEach(o=>{const r=this.dbDriver[o];let s;s=t.objectStoreNames.contains(o)?e.objectStore(o):t.createObjectStore(o,{keyPath:r.keyPath}),r.indexes.forEach(t=>{s.indexNames.contains(t.indexName)||s.createIndex(t.indexName,t.keyPath,{unique:t.unique})})})}catch(t){this.errors.push(t)}}async _set(t){let e=this;return await new Promise((o,r)=>{let s=this._openDatabaseRequest();s.onsuccess=(async e=>{const r=e.target.result;let s=await this._putItem(r,t);o(s)}),s.onerror=(t=>{e.errors.push(t.target),r()})})}async _putItem(t,e){let o=this;return await new Promise((r,s)=>{try{const i=t.transaction([e.objectStoreName],"readwrite");i.onerror=(t=>{o.errors.push(t.target),s()});const n=i.objectStore(e.objectStoreName);let a=e.dataItems.length;for(let t of e.dataItems){const e=n.put(t);e.onsuccess=(()=>{0===(a-=1)&&r(!0)}),e.onerror=(()=>{o.errors.push(event.target),s()})}}catch(t){if(t)return void o.errors.push(t)}})}async _getFromStore(t){let e=this;return await new Promise((o,r)=>{let s=this._openDatabaseRequest();s.onsuccess=(s=>{try{const i=s.target.result.transaction([t.objectStoreName]).objectStore(t.objectStoreName).index(t.condition.indexName),n=this.IDBKeyRange[t.condition.type](t.condition.value),a=i.getAll(n,0);a.onsuccess=(t=>{o(t.target.result)}),a.onerror=(t=>{e.errors.push(t.target),r()})}catch(t){e.errors.push(t),r()}}),s.onerror=(t=>{r(t.target)})})}async _deleteFromStore(t){let e=this;return await new Promise((o,r)=>{let s=this._openDatabaseRequest();s.onsuccess=(s=>{try{const i=s.target.result.transaction([t.objectStoreName],"readwrite").objectStore(t.objectStoreName).index(t.condition.indexName),n=this.IDBKeyRange[t.condition.type](t.condition.value);let a=i.openCursor(n),l=0;a.onsuccess=(t=>{const s=t.target.result;if(s){const t=s.delete();t.onerror=(t=>{e.errors.push(t.target),r()}),t.onsuccess=(t=>{l+=1}),s.continue()}else o(l)})}catch(t){e.errors.push(t),r()}}),s.onerror=(t=>{e.errors.push(t.target),r()})})}}class RemoteDBAdapter{create(){return!0}update(){return!0}deleteOne(){return!0}deleteMany(){return!0}query(){return[]}}class user_data_manager_UserDataManager{constructor(t,e){this.userID=t,e&&(e.WORDITEM_UPDATED.sub(this.update.bind(this)),e.WORDITEM_DELETED.sub(this.delete.bind(this)),e.WORDLIST_DELETED.sub(this.deleteMany.bind(this))),this.blocked=!1,this.requestsQueue=[]}_localStorageAdapter(t){let e=new user_data_manager_UserDataManager.LOCAL_DRIVER_CLASSES[t](this.userID);return new IndexedDBAdapter(e)}_remoteStorageAdapter(t){let e=new user_data_manager_UserDataManager.REMOTE_DRIVER_CLASSES[t](this.userID);return new RemoteDBAdapter(e)}defineConstructorName(t){let e,o=t.substr(0,1);if(o==o.toUpperCase())e=t;else{let o=t.split("_").length-1,r=t.replace("_","").toLowerCase().length/2;e=t.substr(-(r+o-2))}return e}async update(t){this.blocked&&this.requestsQueue.push({method:"update",data:t});try{this.blocked=!0;let e=this.defineConstructorName(t.dataObj.constructor.name),o=this._localStorageAdapter(e),r=this._remoteStorageAdapter(e),s=await o.update(t.dataObj,t.params),i=await r.update(t.dataObj,t.params);return this.printErrors(o),this.blocked=!1,this.checkRequestQueue(),s&&i}catch(t){console.error("Some errors happen on updating data in IndexedDB",t.message)}}async delete(t){this.blocked&&this.requestsQueue.push({method:"delete",data:t});try{this.blocked=!0;let e=this.defineConstructorName(t.dataObj.constructor.name),o=this._localStorageAdapter(e),r=this._remoteStorageAdapter(e),s=await o.deleteOne(t.dataObj),i=await r.deleteOne(t.dataObj);return this.printErrors(o),this.blocked=!1,this.checkRequestQueue(),s&&i}catch(t){console.error("Some errors happen on deleting data from IndexedDB",t.message)}}async deleteMany(t){this.blocked&&this.requestsQueue.push({method:"deleteMany",data:t});try{this.blocked=!0;let e=this._remoteStorageAdapter(t.dataType),o=this._localStorageAdapter(t.dataType),r=o.deleteMany(t.params),s=e.deleteMany(t.params);const i=[await r,await s];this.printErrors(o),this.blocked=!1,console.info("Result of deleted many from IndexedDB",i),this.checkRequestQueue()}catch(t){console.error("Some errors happen on deleting data from IndexedDB",t.message)}}async query(t){let e=this._remoteStorageAdapter(t.dataType),o=this._localStorageAdapter(t.dataType),r=await e.query(t.params),s=await o.query(t.params);this.printErrors(o),r.length>0&&o.deleteMany(params);let i=[],n=[];return s.forEach(t=>{let e=!1;for(let o=0;o<r.length;o++)if(r[o].isSameItem(t)&&(e=!0,r[o].isNotEqual(t))){let e=r[o].merge(t);r[o]=e,n.push(r[o].merge(t))}e||i.push(t)}),i.forEach(t=>{e.create(t)}),n.forEach(t=>{e.update(t)}),[...r,...i].forEach(t=>{o.create(t)}),[...r,...i]}checkRequestQueue(){if(this.requestsQueue.length>0){let t=this.requestsQueue.shift();this[t.method](t.data)}}printErrors(t){t.errors&&t.errors.length>0&&t.errors.forEach(t=>console.error(`Print error - ${t.message}`))}}user_data_manager_UserDataManager.LOCAL_DRIVER_CLASSES={WordItem:worditem_indexeddb_driver_WordItemIndexedDbDriver},user_data_manager_UserDataManager.REMOTE_DRIVER_CLASSES={WordItem:class WordItemRemoteDbDriver{}},o.d(e,"Style",function(){return s.a}),o.d(e,"WordlistController",function(){return wordlist_controller_WordlistController}),o.d(e,"WordListPanel",function(){return A}),o.d(e,"UserDataManager",function(){return user_data_manager_UserDataManager})}])});