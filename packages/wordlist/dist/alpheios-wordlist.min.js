!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t(require("alpheios-data-models"),require("intl-messageformat"));else if("function"==typeof define&&define.amd)define(["alpheios-data-models","intl-messageformat"],t);else{var o="object"==typeof exports?t(require("alpheios-data-models"),require("intl-messageformat")):t(e["alpheios-data-models"],e["intl-messageformat"]);for(var r in o)("object"==typeof exports?exports:e)[r]=o[r]}}(window,function(e,t){return function(e){var t={};function o(r){if(t[r])return t[r].exports;var s=t[r]={i:r,l:!1,exports:{}};return e[r].call(s.exports,s,s.exports,o),s.l=!0,s.exports}return o.m=e,o.c=t,o.d=function(e,t,r){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(o.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)o.d(r,s,function(t){return e[t]}.bind(null,s));return r},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=19)}([function(t,o){t.exports=e},function(e,t,o){},function(e,t,o){},function(e,t,o){},function(e,t,o){},function(e,t,o){},function(e){e.exports={TOOLTIP_ALL_IMPORTANT:{message:"Make all important ",description:"Make all words inside language block important",component:"WordLanguagePanel"},TOOLTIP_NO_IMPORTANT:{message:"Remove all important ",description:"Remove important mark from all words inside language block",component:"WordLanguagePanel"},TOOLTIP_REMOVE_ALL:{message:"Remove all word items",description:"Remove all words inside language block",component:"WordLanguagePanel"},TOOLTIP_CHANGE_IMPORTANT:{message:"Change important status",description:"Change important status for the WordItem",component:"WordItemPanel"},TOOLTIP_REMOVE:{message:"Remove worditem",description:"Remove the WordItem form the list",component:"WordItemPanel"},TOOLTIP_TEXT_CONTEXT:{message:"Show contexts",description:"Show panle with contexts for the wordItem",component:"WordItemPanel"},TOOLTIP_BACK:{message:"Back to WordList",description:"Back to the WordList Tab",component:"WordContextPanel"}}},function(e){e.exports={COOKIE_TEST_MESSAGE:{message:"This is a test message about a biscuit.",description:"A test message that is shown in a panel",component:"Panel"},NUM_LINES_TEST_MESSAGE:{message:"There {numLines, plural, =0 {are no queues} =1 {is one queue} other {are # queues}}.",description:"A test message that is shown in a panel",component:"Panel",params:["numLines"]}}},function(e,t){e.exports={render:function(){var e=this.$createElement,t=this._self._c||e;return t("svg",{attrs:{viewBox:"0 0 447.6 757.4"}},[t("path",{attrs:{d:"M-128.4 305.8c74.8 53.3 146.8 110.5 215.7 171.3 0 0 348.4-399.4 557.1-477.1l27 53S277.2 418 150.5 757.4l-374.3-378.7 95.4-72.9z"}})])},toString:function(){return"C:\\_Alpheios\\wordlist\\src\\icons\\check.svg"}}},function(e,t){e.exports={render:function(){var e=this.$createElement,t=this._self._c||e;return t("svg",{attrs:{viewBox:"0 0 900.5 900.5"}},[t("path",{attrs:{d:"M176.42 880.5c0 11.046 8.954 20 20 20h507.67c11.046 0 20-8.954 20-20V232.49H176.42V880.5zm386.33-537.73h75V778.8h-75V342.77zm-150 0h75V778.8h-75V342.77zm-150 0h75V778.8h-75V342.77zM618.82 91.911V20c0-11.046-8.954-20-20-20H301.67c-11.046 0-20 8.954-20 20v96.911h-139.8c-11.046 0-20 8.954-20 20v50.576c0 11.045 8.954 20 20 20h616.75c11.046 0 20-8.955 20-20v-50.576c0-11.046-8.954-20-20-20h-139.8V91.912zm-75 20.889H356.67V75.001h187.15v37.801z"}})])},toString:function(){return"C:\\_Alpheios\\wordlist\\src\\icons\\delete.svg"}}},function(e,t,o){},function(e,o){e.exports=t},function(e,t){e.exports={render:function(){var e=this.$createElement,t=this._self._c||e;return t("svg",{attrs:{viewBox:"0 0 442 442"}},[t("path",{attrs:{d:"M171 336H70c-5.523 0-10 4.477-10 10s4.477 10 10 10h101c5.523 0 10-4.477 10-10s-4.477-10-10-10zM322 336H221c-5.523 0-10 4.477-10 10s4.477 10 10 10h101c5.522 0 10-4.477 10-10s-4.478-10-10-10zM322 86H70c-5.523 0-10 4.477-10 10s4.477 10 10 10h252c5.522 0 10-4.477 10-10s-4.478-10-10-10zM322 136H221c-5.523 0-10 4.477-10 10s4.477 10 10 10h101c5.522 0 10-4.477 10-10s-4.478-10-10-10zM322 186H221c-5.523 0-10 4.477-10 10s4.477 10 10 10h101c5.522 0 10-4.477 10-10s-4.478-10-10-10zM322 236H221c-5.523 0-10 4.477-10 10s4.477 10 10 10h101c5.522 0 10-4.477 10-10s-4.478-10-10-10zM322 286H221c-5.523 0-10 4.477-10 10s4.477 10 10 10h101c5.522 0 10-4.477 10-10s-4.478-10-10-10zM171 286H70c-5.523 0-10 4.477-10 10s4.477 10 10 10h101c5.523 0 10-4.477 10-10s-4.477-10-10-10zM171 136H70c-5.523 0-10 4.477-10 10v101c0 5.523 4.477 10 10 10h101c5.523 0 10-4.477 10-10V146c0-5.523-4.477-10-10-10zm-10 101H80v-81h81v81z"}}),t("path",{attrs:{d:"M422 76h-30V46c0-11.028-8.972-20-20-20H20C8.972 26 0 34.972 0 46v320c0 27.57 22.43 50 50 50h342c27.57 0 50-22.43 50-50V96c0-11.028-8.972-20-20-20zm0 290c0 16.542-13.458 30-30 30H50c-16.542 0-30-13.458-30-30V46h352v305c0 13.785 11.215 25 25 25 5.522 0 10-4.477 10-10s-4.478-10-10-10c-2.757 0-5-2.243-5-5V96h30v270z"}})])},toString:function(){return"C:\\_Alpheios\\wordlist\\src\\icons\\text-quote.svg"}}},function(e,t){e.exports={render:function(){var e=this.$createElement,t=this._self._c||e;return t("svg",{attrs:{viewBox:"0 0 459 459"}},[t("path",{attrs:{d:"M178.5 140.25v-102L0 216.75l178.5 178.5V290.7c127.5 0 216.75 40.8 280.5 130.05-25.5-127.5-102-255-280.5-280.5z"}})])},toString:function(){return"C:\\_Alpheios\\wordlist\\src\\icons\\back.svg"}}},function(e,t,o){"use strict";var r=o(1);o.n(r).a},function(e,t,o){"use strict";var r=o(2);o.n(r).a},function(e,t,o){"use strict";var r=o(3);o.n(r).a},function(e,t,o){"use strict";var r=o(4);o.n(r).a},function(e,t,o){"use strict";var r=o(5);o.n(r).a},function(e,t,o){"use strict";o.r(t);var r=o(10),s=o.n(r),a=o(0);class word_item_WordItem{constructor(e={targetWord:null,languageCode:null,important:!1,currentSession:!0,context:[],homonym:{}}){if(this.version=1,this.targetWord=e.targetWord,this.languageCode=e.languageCode,!this.targetWord||!this.languageCode)throw new Error("Unable to construct a worditem without at least a targetWord and a languageCode");this.important=void 0!==e.important&&e.important,this.currentSession=null==e.currentSession||e.currentSession,this.context=e.context||[],this.homonym=e.homonym||{}}static readObject(e){let t={},o=[];return e.homonym&&(t=word_item_WordItem.readHomonym(e)),e.context&&(o=word_item_WordItem.readContext(e)),new word_item_WordItem({targetWord:e.targetWord,languageCode:e.languageCode,important:e.important,currentSession:e.currentSession,context:o,homonym:t})}static readHomonym(e){return a.Homonym.readObject(e.homonym)}get hasTextQuoteSelectors(){return this.context.length>0}static readContext(e){let t=[];for(let o of e){let e=a.TextQuoteSelector.readObject(o);t.push(e)}return t}addContext(e){for(let t of e){0==this.context.filter(e=>e.isEqual(t)).length&&this.context.push(t)}}get lemmasList(){return this.homonym&&this.homonym.lexemes?this.homonym.lexemes.map(e=>e.lemma.word).filter((e,t,o)=>o.indexOf(e)===t).join(", "):""}merge(e){let t=["homonym","important","currentSession"];for(let o of t)this._emptyProp(o)&&!e._emptyProp(o)&&(this[o]=e[o])}_emptyProp(e){return!this[e]||"object"==typeof this[e]&&0===Object.keys(this[e]).length}get formattedContext(){let e={};for(let t of this.context)e[t.source]||(e[t.source]=[]),e[t.source].push(t);return e}}class word_list_WordList{constructor(e,t=[]){if(!e)throw new Error("Unable to construct a wordlist without a languagecode");this.languageCode=e,this.items={},t.forEach(e=>{this.addWordItem(e)})}get values(){return Object.values(this.items)}get isEmpty(){return 0===Object.values(this.items).length}addWordItem(e){if(e.languageCode!==this.languageCode)throw new Error(`Language Code mismatch ${e.languageCode} !=== ${this.languageCode}`);let t=this.getWordItem(e.targetWord,!1);t&&(e=e.merge(t));let o=this._makeItemKey(this.languageCode,e.targetWord);this.items[o]=e}deleteWordItem(e){let t=this._makeItemKey(this.languageCode,e),o=this.items[t];return o&&delete this.items[t],o}removeAllWordItems(){this.items={}}getWordItem(e,t=!0,o=null){let r=this._makeItemKey(this.languageCode,e);if(t&&!this.items[r]){let t=new word_item_WordItem({targetWord:e,languageCode:this.languageCode});o&&o.pub({dataObj:t,params:{segment:"common"}}),this.items[r]=t}return this.items[r]}_makeItemKey(e,t){return`${e}:${t}`}}class wordlist_controller_WordlistController{constructor(e,t){this.wordLists={},this.availableLangs=e,t.TEXT_QUOTE_SELECTOR_RECEIVED.sub(this.onTextQuoteSelectorReceived.bind(this)),t.HOMONYM_READY.sub(this.onHomonymReady.bind(this)),t.DEFS_READY.sub(this.onDefinitionsReady.bind(this)),t.LEMMA_TRANSL_READY.sub(this.onLemmaTranslationsReady.bind(this))}async initLists(e){for(let t of this.availableLangs){let o=await e.query({dataType:"WordItem",params:{languageCode:t}});o.length>0&&(this.wordLists[t]=new word_list_WordList(t,o))}wordlist_controller_WordlistController.evt.WORDLIST_UPDATED.pub(this.wordLists)}getWordList(e,t=!0){if(t&&!this._wordListExist(e)){let t=new word_list_WordList(e,[]);this.wordLists[e]=t,wordlist_controller_WordlistController.evt.WORDLIST_CREATED.pub(t)}return this.wordLists[e]}removeWordList(e){this.wordLists[e];delete this.wordLists[e],wordlist_controller_WordlistController.evt.WORDLIST_DELETED.pub({dataType:"WordItem",params:{languageCode:e}}),wordlist_controller_WordlistController.evt.WORDLIST_UPDATED.pub(this.wordLists)}removeWordListItem(e,t){let o=this.getWordList(e,!1);if(o){let e=o.deleteWordItem(t);e&&wordlist_controller_WordlistController.evt.WORDITEM_DELETED.pub({dataObj:e})}}getWordListItem(e,t,o=!1){let r,s=this.getWordList(e,o);return s&&(r=s.getWordItem(t,o,wordlist_controller_WordlistController.evt.WORDITEM_UPDATED)),r}onHomonymReady(e){let t=this.getWordListItem(e.language,e.targetWord,!0);t.homonym=e,wordlist_controller_WordlistController.evt.WORDITEM_UPDATED.pub({dataObj:t,params:{segment:"shortHomonym"}}),wordlist_controller_WordlistController.evt.WORDLIST_UPDATED.pub(this.wordLists)}onDefinitionsReady(e){let t=this.getWordListItem(e.homonym.language,e.homonym.targetWord);t?(t.homonym=e.homonym,wordlist_controller_WordlistController.evt.WORDITEM_UPDATED.pub({dataObj:t,params:{segment:"fullHomonym"}})):console.error("Something went wrong: request to add definitions to non-existent item")}onLemmaTranslationsReady(e){let t=this.getWordListItem(e.language,e.targetWord);t?(t.homonym=e,wordlist_controller_WordlistController.evt.WORDITEM_UPDATED.pub({dataObj:t,params:{segment:"fullHomonym"}})):console.error("Something went wrong: request to add translations to non-existent item")}onTextQuoteSelectorReceived(e){let t=this.getWordListItem(e.languageCode,e.normalizedText,!0);t?(t.addContext([e]),wordlist_controller_WordlistController.evt.WORDITEM_UPDATED.pub({dataObj:t,params:{segment:"context"}}),wordlist_controller_WordlistController.evt.WORDLIST_UPDATED.pub(this.getWordList(t.languageCode))):console.error("Unable to create or retrieve worditem")}updateWordItemImportant(e,t,o){let r=this.getWordListItem(e,t,!1);r?(r.important=o,wordlist_controller_WordlistController.evt.WORDITEM_UPDATED.pub({dataObj:r,params:{segment:"common"}})):console.error("Something went wrong: request to set important flag on non-existent item")}updateAllImportant(e,t){this.getWordList(e,!1).values.forEach(e=>{e.important=t,wordlist_controller_WordlistController.evt.WORDITEM_UPDATED.pub({dataObj:e,params:{segment:"common"}})})}selectWordItem(e,t){let o=this.getWordListItem(e,t,!1);wordlist_controller_WordlistController.evt.WORDITEM_SELECTED.pub(o.homonym)}_wordListExist(e){return Object.keys(this.wordLists).includes(e)}}wordlist_controller_WordlistController.evt={WORDLIST_UPDATED:new a.PsEvent("Wordlist updated",wordlist_controller_WordlistController),WORDLIST_CREATED:new a.PsEvent("Wordlist created",wordlist_controller_WordlistController),WORDLIST_DELETED:new a.PsEvent("Wordlist deleted",wordlist_controller_WordlistController),WORDITEM_SELECTED:new a.PsEvent("WordItem selected",wordlist_controller_WordlistController),WORDITEM_UPDATED:new a.PsEvent("WordItem updated",wordlist_controller_WordlistController),WORDITEM_DELETED:new a.PsEvent("WordItem deleted",wordlist_controller_WordlistController)};var n=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",[e.showContext?e._e():o("div",{staticClass:"alpheios-wordlist"},e._l(e.languagesList,function(t,r){return o("div",{key:r,staticClass:"alpheios-wordlist-language"},[o("word-language",{attrs:{controller:e.wordlistC,languageCode:t,messages:e.l10n.messages,updated:e.updated},on:{showContexts:e.showContexts}})],1)}),0),e._v(" "),e.showContext?o("div",{staticClass:"alpheios-wordlist-contexts"},[o("word-context",{attrs:{worditem:e.showContextWordItem,messages:e.l10n.messages},on:{backToWordList:e.backToWordList}})],1):e._e()])};n._withStripped=!0;var i=o(11),l=o.n(i);class message_Message{constructor(e,t){if(!t)throw new Error("Locale data is missing");if(!e)throw new Error("Message data is missing");this.locale=t;for(const t of Object.keys(e))this[t]=e[t];this.formatFunc=new l.a(e.message,this.locale)}get hasParameters(){return!!(this.params&&Array.isArray(this.params)&&this.params.length>0)}defineProperties(e,t){let o=this;this.hasParameters?e[t]={format:e=>o.formatFunc.format(e),get(...e){let t={};for(let[r,s]of o.params.entries())t[s]=e[r];return o.formatFunc.format(t)}}:Object.defineProperty(e,t,{get:()=>o.formatFunc.format(),enumerable:!0,configurable:!0})}}class message_bundle_MessageBundle{constructor(e,t){if(!t)throw new Error("Locale data is missing");if(!e)throw new Error("Message data is missing");this._locale=t,this.messages={};let o="string"==typeof e?JSON.parse(e):e;this.append(o)}appendFromJSON(e){let t=JSON.parse(e);this.append(t)}append(e){for(const[t,o]of Object.entries(e))if(this.hasOwnProperty(t))console.warn(`A key name "${t}" is reserved or already used. A message will be ignored"`);else{let e=new message_Message(o,this._locale);this[t]=e,e.defineProperties(this.messages,t)}}get(e,t){return this[e]?"function"==typeof this[e].format?this[e].format(t):this[e]:`Not in translation data: "${e}"`}get locale(){return this._locale}}class l10n_L10n{constructor(){return this.selectedLocale=void 0,this.bundles=new Map,this}addMessages(e,t){let o;return this.bundles.has(t)?(o=this.bundles.get(t)).appendFromJSON(e):(o=new message_bundle_MessageBundle(e,t),this.addMessageBundle(o)),this}addMessageBundle(e){return this.bundles.set(e.locale,e),this.selectedLocale||this.setLocale(e.locale),this}get locales(){return Array.from(this.bundles.keys())}get bundle(){return this.bundles.get(this.selectedLocale)}get messages(){return this.bundles.has(this.selectedLocale)?this.bundles.get(this.selectedLocale).messages:{}}setLocale(e){return this.bundles.has(e)?this.selectedLocale=e:console.error(`Cannot set locale to "${e}" because there is no message bundle for it`),this}}var d=o(6),c=o(7),m="en-US",u="en-GB",h=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",[o("div",{staticClass:"alpheios-wordlist-commands"},[o("div",{staticClass:"alpheios-wordlist-language__title"},[e._v(e._s(e.languageName))]),e._v(" "),o("alph-tooltip",{attrs:{tooltipDirection:"top-left",tooltipText:e.messages.TOOLTIP_ALL_IMPORTANT}},[o("div",{staticClass:"alpheios-wordlist-commands__item alpheios-wordlist-commands__item-all-important",on:{click:function(t){e.makeAllImportant()}}},[o("check-icon")],1)]),e._v(" "),o("alph-tooltip",{attrs:{tooltipDirection:"top-left",tooltipText:e.messages.TOOLTIP_NO_IMPORTANT}},[o("div",{staticClass:"alpheios-wordlist-commands__item alpheios-wordlist-commands__item-no-important",on:{click:function(t){e.removeAllImportant()}}},[o("check-icon")],1)]),e._v(" "),o("alph-tooltip",{attrs:{tooltipDirection:"top-left",tooltipText:e.messages.TOOLTIP_REMOVE_ALL}},[o("div",{staticClass:"alpheios-wordlist-commands__item alpheios-wordlist-commands__item-remove-all",on:{click:function(t){e.deleteAll()}}},[o("delete-icon")],1)])],1),e._v(" "),e._l(e.wordItems,function(t){return o("div",{key:t.targetWord},[o("word-item",{attrs:{controller:e.controller,worditem:t,messages:e.messages,updated:e.updated},on:{changeImportant:e.changeImportant,deleteItem:e.deleteItem,showContexts:e.showContexts}})],1)})],2)};h._withStripped=!0;var p=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"alpheios-tooltip",style:e.additionalStyles},[e._t("default"),e._v(" "),e.tooltipText?o("span",{staticClass:"alpheios-tooltip__text",class:e.finalTooltipDirection},[e._v("\n    "+e._s(e.tooltipText)+"\n  ")]):e._e()],2)};function g(e,t,o,r,s,a,n,i){var l,d="function"==typeof e?e.options:e;if(t&&(d.render=t,d.staticRenderFns=o,d._compiled=!0),r&&(d.functional=!0),a&&(d._scopeId="data-v-"+a),n?(l=function(e){(e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),s&&s.call(this,e),e&&e._registeredComponents&&e._registeredComponents.add(n)},d._ssrRegister=l):s&&(l=i?function(){s.call(this,this.$root.$options.shadowRoot)}:s),l)if(d.functional){d._injectStyles=l;var c=d.render;d.render=function(e,t){return l.call(t),c(e,t)}}else{var m=d.beforeCreate;d.beforeCreate=m?[].concat(m,l):[l]}return{exports:e,options:d}}p._withStripped=!0;var _=g({name:"TooltipWrap",data:()=>({allowedTooltipClasses:["alpheios-tooltip__top","alpheios-tooltip__top-right","alpheios-tooltip__top-left","alpheios-tooltip__bottom","alpheios-tooltip__bottom-right","alpheios-tooltip__bottom-wide","alpheios-tooltip__bottom-narrow","alpheios-tooltip__bottom-narrow2","alpheios-tooltip__left","alpheios-tooltip__right"],defaultTooltipClass:"alpheios-tooltip__bottom"}),props:{tooltipText:{type:String,required:!0},tooltipDirection:{type:String,required:!1},additionalStyles:{type:Object,required:!1}},computed:{tooltipDirectionLC:function(){return this.tooltipDirection?this.tooltipDirection.toLowerCase():""},tooltipDirectionClass:function(){return"alpheios-tooltip__"+this.tooltipDirectionLC},finalTooltipDirection:function(){return this.allowedTooltipClasses.indexOf(this.tooltipDirectionClass)>-1?this.tooltipDirectionClass:this.defaultTooltipClass}}},p,[],!1,null,null,null);_.options.__file="vue-components/common-components/tooltip-wrap.vue";var w=_.exports,f=o(8),I=o.n(f),b=o(9),D=o.n(b),y=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"alpheios-wordlist-language__worditem",class:e.itemClasses},[o("alph-tooltip",{attrs:{tooltipDirection:"top-left",tooltipText:e.messages.TOOLTIP_CHANGE_IMPORTANT}},[o("div",{staticClass:"alpheios-worditem__data alpheios-worditem__icon",on:{click:function(t){e.changeImportant()}}},[o("check-icon")],1)]),e._v(" "),o("alph-tooltip",{attrs:{tooltipDirection:"top-left",tooltipText:e.messages.TOOLTIP_REMOVE}},[o("div",{staticClass:"alpheios-worditem__data alpheios-worditem__icon alpheios-worditem__delete_icon",on:{click:function(t){e.deleteItem()}}},[o("delete-icon")],1)]),e._v(" "),o("alph-tooltip",{class:{"alpheios_no_tq ":!e.worditem.hasTextQuoteSelectors},attrs:{tooltipDirection:"top-left",tooltipText:e.messages.TOOLTIP_TEXT_CONTEXT}},[o("div",{staticClass:"alpheios-worditem__data alpheios-worditem__icon alpheios-worditem__delete_icon",on:{click:function(t){e.showContexts()}}},[o("text-quote-icon")],1)]),e._v(" "),o("div",{staticClass:"alpheios-worditem__data alpheios-worditem__targetWord",on:{click:function(t){e.selectWordItem()}}},[e._v(e._s(e.worditem.targetWord))]),e._v(" "),o("div",{staticClass:"alpheios-worditem__data alpheios-worditem__lemmasList"},[e._v(e._s(e.lemmasList))])],1)};y._withStripped=!0;var v=o(12),C=o.n(v),W={name:"WordItemBlock",components:{checkIcon:I.a,deleteIcon:D.a,textQuoteIcon:C.a,alphTooltip:w},props:{controller:{type:Object,required:!0},worditem:{type:Object,required:!0},messages:{type:Object,required:!0},updated:{type:Number,required:!0}},data:()=>({important:!1}),mounted(){this.important=this.worditem.important,this.$parent.$on("eventChangeImportant",this.eventChangeImportant)},computed:{itemClasses(){return{"alpheios-wordlist-language__worditem__active":this.important,"alpheios-wordlist-language__worditem__current_session":this.worditem.currentSession}},lemmasList(){return this.updated?this.worditem.lemmasList:""}},methods:{changeImportant(){this.$emit("changeImportant",this.worditem.targetWord,!this.worditem.important),this.important=this.worditem.important},eventChangeImportant(){this.important=this.worditem.important},selectWordItem(){this.controller.selectWordItem(this.worditem.languageCode,this.worditem.targetWord)},deleteItem(){this.$emit("deleteItem",this.worditem.targetWord)},showContexts(){this.$emit("showContexts",this.worditem.targetWord)}}},T=(o(14),g(W,y,[],!1,null,null,null));T.options.__file="vue-components/word-item-panel.vue";var x=T.exports,S={name:"WordLanguagePanel",components:{checkIcon:I.a,deleteIcon:D.a,wordItem:x,alphTooltip:w},props:{controller:{type:Object,required:!0},languageCode:{type:String,required:!0},messages:{type:Object,required:!0},updated:{type:Number,required:!0}},data:()=>({reloadList:1}),computed:{wordlist(){return this.controller.getWordList(this.languageCode)},wordItems(){return this.updated&&this.reloadList?this.wordlist.values:[]},languageName(){return this.languageCode}},methods:{async makeAllImportant(){await this.controller.updateAllImportant(this.languageCode,!0),this.$emit("eventChangeImportant")},async removeAllImportant(){await this.controller.updateAllImportant(this.languageCode,!1),this.$emit("eventChangeImportant")},async changeImportant(e,t){await this.controller.updateWordItemImportant(this.languageCode,e,t)},async deleteItem(e){await this.controller.removeWordListItem(this.languageCode,e),this.reloadList=this.reloadList+1},async deleteAll(){await this.controller.removeWordList(this.languageCode),this.reloadList=this.reloadList+1},showContexts(e){this.$emit("showContexts",e,this.languageCode)}}},L=(o(15),g(S,h,[],!1,null,null,null));L.options.__file="vue-components/word-language-panel.vue";var E=L.exports,O=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",[o("div",{staticClass:"alpheios-wordlist-commands"},[o("alph-tooltip",{attrs:{tooltipDirection:"top-left",tooltipText:e.messages.TOOLTIP_BACK}},[o("div",{staticClass:"alpheios-wordlist-commands__item alpheios-wordlist-commands__item-back",on:{click:e.backToWordList}},[o("back-icon")],1)]),e._v(" "),o("div",{staticClass:"alpheios-wordlist-language__title"},[e._v(e._s(e.worditem.targetWord)+" ("+e._s(e.worditem.languageCode)+")")])],1),e._v(" "),e._l(e.sourcesList,function(t){return o("div",{staticClass:"alpheios-wordlists-tqs"},[o("word-tq-source",{attrs:{source:t,tqSelectors:e.formattedContext[t],messages:e.messages}})],1)})],2)};O._withStripped=!0;var M=o(13),j=o.n(M),R=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"alpheios-wordlists-tq"},[o("a",{staticClass:"alpheios-wordlists-tq-title",attrs:{href:e.source}},[e._v(e._s(e.source))]),e._v(" "),e._l(e.tqSelectors,function(t){return o("div",{key:t.ID,staticClass:"alpheios-wordlists-tq-contextHTML-block"},[o("p",{staticClass:"alpheios-wordlists-tq-contextHTML",domProps:{innerHTML:e._s(t.contextHTML)}})])})],2)};R._withStripped=!0;var A={name:"WordTQSourceBlock",props:{source:{type:String,required:!0},tqSelectors:{type:Array,required:!0},messages:{type:Object,required:!0}},computed:{},methods:{}},P=(o(16),g(A,R,[],!1,null,null,null));P.options.__file="vue-components/word-tq-source-block.vue";var N=P.exports,k={name:"WordContextBlock",components:{backIcon:j.a,alphTooltip:w,wordTqSource:N},props:{worditem:{type:Object,required:!0},messages:{type:Object,required:!0}},computed:{formattedContext(){return this.worditem.formattedContext},sourcesList(){return Object.keys(this.formattedContext)}},methods:{backToWordList(){this.$emit("backToWordList")}}},q=(o(17),g(k,O,[],!1,null,null,null));q.options.__file="vue-components/word-context-panel.vue";var B={name:"WordListPanel",components:{wordLanguage:E,wordContext:q.exports},props:{wordlistC:{type:Object,required:!0},updated:{type:Number,required:!0}},data:()=>({showContextWordItem:null}),computed:{languagesList(){return this.showContextWordItem=null,this.updated&&Object.keys(this.wordLists).length>0?Object.keys(this.wordLists):[]},l10n:()=>(new l10n_L10n).addMessages(d,m).addMessages(c,u).setLocale(m),wordLists(){return this.updated?this.wordlistC.wordLists:[]},showContext(){return Boolean(this.showContextWordItem)}},methods:{showContexts(e,t){this.showContextWordItem=this.wordLists[t].getWordItem(e)},backToWordList(){this.showContextWordItem=null}}},H=(o(18),g(B,n,[],!1,null,null,null));H.options.__file="vue-components/word-list-panel.vue";var z=H.exports;class worditem_indexeddb_driver_WordItemIndexedDbDriver{constructor(e){this.userId=e,this.storageMap={common:{objectStoreName:"WordListsCommon",serialize:this._serializeCommon.bind(this),delete:this._segmentDeleteQueryByID.bind(this)},context:{objectStoreName:"WordListsContext",serialize:this._serializeContext.bind(this),load:this._loadContext,delete:this._segmentDeleteQueryByWordItemID.bind(this)},shortHomonym:{objectStoreName:"WordListsHomonym",serialize:this._serializeHomonym.bind(this),load:this._loadHomonym,delete:this._segmentDeleteQueryByID.bind(this)},fullHomonym:{objectStoreName:"WordListsFullHomonym",serialize:this._serializeHomonymWithFullDefs.bind(this),load:this._loadHomonym,delete:this._segmentDeleteQueryByID.bind(this)}}}get dbName(){return"AlpheiosWordLists"}get dbVersion(){return 3}get segments(){return Object.keys(this.storageMap)}get objectStores(){return Object.keys(this.storageMap).map(e=>this.storageMap[e].objectStoreName)}get WordListsCommon(){return this._objectStoreTemplate()}get WordListsContext(){let e=this._objectStoreTemplate();return e.indexes.push({indexName:"wordItemID",keyPath:"wordItemID",unique:!1}),e}get WordListsHomonym(){return this._objectStoreTemplate()}get WordListsFullHomonym(){return this._objectStoreTemplate()}load(e){return e.currentSession=!1,new word_item_WordItem(e)}loadSegment(e,t,o){this.storageMap[e].load&&this.storageMap[e].load(t,o)}segmentQuery(e,t){let o=this._makeStorageID(t),r="context"===e?"wordItemID":"ID";return{objectStoreName:this.storageMap[e].objectStoreName,condition:{indexName:r,value:o,type:"only"}}}segmentDeleteQuery(e,t){return this.storageMap[e].delete(e,t)}_segmentDeleteQueryByID(e,t){let o=this._makeStorageID(t);return{objectStoreName:this.storageMap[e].objectStoreName,condition:{indexName:"ID",value:o,type:"only"}}}_segmentDeleteQueryByWordItemID(e,t){let o=this._makeStorageID(t);return{objectStoreName:this.storageMap[e].objectStoreName,condition:{indexName:"wordItemID",value:o,type:"only"}}}segmentDeleteManyQuery(e,t){if(t.languageCode){let o=this.userId+"-"+t.languageCode;return{objectStoreName:this.storageMap[e].objectStoreName,condition:{indexName:"listID",value:o,type:"only"}}}}updateSegmentQuery(e,t){let o=[],r=this.storageMap[e].serialize(t);return Array.isArray(r)?o=o.concat(r):o.push(r),{objectStoreName:this.storageMap[e].objectStoreName,dataItems:o}}listQuery(e){if(e.languageCode){let t=this.userId+"-"+e.languageCode;return{objectStoreName:this.storageMap.common.objectStoreName,condition:{indexName:"listID",value:t,type:"only"}}}throw new Error("Invalid query parameters - missing languageCode")}_loadHomonym(e,t){e.homonym=word_item_WordItem.readHomonym(t[0])}_loadContext(e,t){Array.isArray(t)||(t=[t]),e.context=word_item_WordItem.readContext(t)}_serializeCommon(e){return{ID:this._makeStorageID(e),listID:this.userId+"-"+e.languageCode,userID:this.userId,languageCode:e.languageCode,targetWord:e.targetWord,important:e.important,createdDT:worditem_indexeddb_driver_WordItemIndexedDbDriver.currentDate}}_serializeContext(e){let t=[],o=0,r=this._makeStorageID(e);for(let s of e.context){let a={ID:r+"-"+ ++o,listID:this.userId+"-"+e.languageCode,userID:this.userId,languageCode:e.languageCode,targetWord:e.targetWord,wordItemID:r,target:{source:s.source,selector:{type:"TextQuoteSelector",exact:s.text,prefix:s.prefix,suffix:s.suffix,contextHTML:s.contextHTML,languageCode:s.languageCode}},createdDT:worditem_indexeddb_driver_WordItemIndexedDbDriver.currentDate};t.push(a)}return t}_serializeHomonym(e,t=!1){let o=e.homonym&&e.homonym instanceof a.Homonym?e.homonym.convertToJSONObject(t):{};return{ID:this._makeStorageID(e),listID:this.userId+"-"+e.languageCode,userID:this.userId,languageCode:e.languageCode,targetWord:e.targetWord,homonym:o}}_serializeHomonymWithFullDefs(e){return this._serializeHomonym(e,!0)}_makeStorageID(e){return this.userId+"-"+e.languageCode+"-"+e.targetWord}_objectStoreTemplate(){return{keyPath:"ID",indexes:[{indexName:"ID",keyPath:"ID",unique:!0},{indexName:"listID",keyPath:"listID",unique:!1},{indexName:"userID",keyPath:"userID",unique:!1},{indexName:"languageCode",keyPath:"languageCode",unique:!1},{indexName:"targetWord",keyPath:"targetWord",unique:!1}]}}static get currentDate(){let e=new Date;return e.getFullYear()+"/"+(e.getMonth()+1<10?"0":"")+(e.getMonth()+1)+"/"+(e.getDate()<10?"0":"")+e.getDate()+" @ "+(e.getHours()<10?"0":"")+e.getHours()+":"+(e.getMinutes()<10?"0":"")+e.getMinutes()+":"+(e.getSeconds()<10?"0":"")+e.getSeconds()}}class IndexedDBAdapter{constructor(e){this.available=this._initIndexedDBNamespaces(),this.dbDriver=e}async create(e){let t,o=this.dbDriver.segments;for(let r of o)if(!(t=await this.update(e,{segment:r})))break;return t>0}async deleteMany(e){let t={};for(let o of this.dbDriver.segments){let r=this.dbDriver.segmentDeleteManyQuery(o,e),s=await this._deleteFromStore(r);t[o]=s}return t}async deleteOne(e){for(let t of this.dbDriver.segments){let o=this.dbDriver.segmentDeleteQuery(t,e);await this._deleteFromStore(o)}}async update(e,t){let o=[t.segment];0===o.length&&(o=this.dbDriver.segments);for(let t of o){let o=this.dbDriver.updateSegmentQuery(t,e);try{return await this._set(o)}catch(e){return console.error("Error on update",e),!1}}}async query(e){let t=this.dbDriver.listQuery(e),o=await this._getFromStore(t),r=[];if(o.length>0)for(let e of o){let t=this.dbDriver.load(e),o=this.dbDriver.segments;for(let e of o){let o=this.dbDriver.segmentQuery(e,t),r=await this._getFromStore(o);r.length>0&&this.dbDriver.loadSegment(e,t,r)}r.push(t)}return r}clear(){this.indexedDB.open(this.dbDriver.dbName,this.dbDriver.dbVersion).onsuccess=(e=>{let t=e.target.result,o=this.dbDriver.objectStores;for(let e of o){let o=t.transaction([e],"readwrite").objectStore(e).clear();o.onsuccess=function(t){console.log(`store ${e} cleared`)},o.onerror=function(t){console.log(`store ${e} clear error`)}}})}_initIndexedDBNamespaces(){return this.indexedDB=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB,this.IDBTransaction=window.IDBTransaction||window.webkitIDBTransaction||window.msIDBTransaction||{READ_WRITE:"readwrite"},this.IDBKeyRange=window.IDBKeyRange||window.webkitIDBKeyRange||window.msIDBKeyRange,!!this.indexedDB||(console.warn("Your browser doesn't support a stable version of IndexedDB. Such and such feature will not be available."),!1)}_openDatabaseRequest(){let e=this.indexedDB.open(this.dbDriver.dbName,this.dbDriver.dbVersion);return e.onupgradeneeded=(e=>{const t=e.target.result,o=e.target.transaction;this._createObjectStores(t,o)}),e}_createObjectStores(e,t){this.dbDriver.objectStores.forEach(o=>{const r=this.dbDriver[o];let s;s=e.objectStoreNames.contains(o)?t.objectStore(o):e.createObjectStore(o,{keyPath:r.keyPath}),r.indexes.forEach(e=>{s.indexNames.contains(e.indexName)||s.createIndex(e.indexName,e.keyPath,{unique:e.unique})})})}async _set(e){return await new Promise((t,o)=>{let r=this._openDatabaseRequest();r.onsuccess=(async o=>{const r=o.target.result;let s=await this._putItem(r,e);t(s)}),r.onerror=(e=>{o()})})}async _putItem(e,t){return await new Promise((o,r)=>{const s=e.transaction([t.objectStoreName],"readwrite");s.onerror=(e=>{r()});const a=s.objectStore(t.objectStoreName);let n=t.dataItems.length;for(let e of t.dataItems){const t=a.put(e);t.onsuccess=(()=>{0===(n-=1)&&o(!0)}),t.onerror=(()=>{console.log("requestPut error",event.target),r()})}})}async _getFromStore(e){return await new Promise((t,o)=>{let r=this._openDatabaseRequest();r.onsuccess=(r=>{const s=r.target.result.transaction([e.objectStoreName]).objectStore(e.objectStoreName).index(e.condition.indexName),a=this.IDBKeyRange[e.condition.type](e.condition.value),n=s.getAll(a,0);n.onsuccess=(e=>{t(e.target.result)}),n.onerror=(e=>{o()})}),r.onerror=(e=>{o()})})}async _deleteFromStore(e){return await new Promise((t,o)=>{let r=this._openDatabaseRequest();r.onsuccess=(r=>{const s=r.target.result.transaction([e.objectStoreName],"readwrite").objectStore(e.objectStoreName).index(e.condition.indexName),a=this.IDBKeyRange[e.condition.type](e.condition.value);let n=s.openCursor(a),i=0;n.onsuccess=(e=>{const r=e.target.result;if(r){const e=r.delete();e.onerror=(e=>{o()}),e.onsuccess=(e=>{i+=1}),r.continue()}else t(i)})}),r.onerror=(e=>{o()})})}}class RemoteDBAdapter{create(){return!0}update(){return!0}deleteOne(){return!0}deleteMany(){return!0}query(){return[]}}class user_data_manager_UserDataManager{constructor(e,t){this.userID=e,t.WORDITEM_UPDATED.sub(this.update.bind(this)),t.WORDITEM_DELETED.sub(this.delete.bind(this)),t.WORDLIST_DELETED.sub(this.deleteMany.bind(this))}_localStorageAdapter(e){let t=new user_data_manager_UserDataManager.LOCAL_DRIVER_CLASSES[e](this.userID);return new IndexedDBAdapter(t)}_remoteStorageAdapter(e){let t=new user_data_manager_UserDataManager.REMOTE_DRIVER_CLASSES[e](this.userID);return new RemoteDBAdapter(t)}defineConstructorName(e){let t,o=e.substr(0,1);if(o==o.toUpperCase())t=e;else{let o=e.split("_").length-1,r=e.replace("_","").toLowerCase().length/2;t=e.substr(-(r+o-2))}return t}async update(e){try{let t=this.defineConstructorName(e.dataObj.constructor.name),o=this._localStorageAdapter(t),r=this._remoteStorageAdapter(t),s=await o.update(e.dataObj,e.params),a=await r.update(e.dataObj,e.params);return s&&a}catch(e){console.error("Some errors happen on updating data in IndexedDB",e.message)}}async delete(e){try{let t=this.defineConstructorName(e.dataObj.constructor.name),o=this._localStorageAdapter(t),r=this._remoteStorageAdapter(t),s=await o.deleteOne(e.dataObj),a=await r.deleteOne(e.dataObj);return s&&a}catch(e){console.error("Some errors happen on deleting data from IndexedDB",e.message)}}async deleteMany(e){try{let t=this._remoteStorageAdapter(e.dataType),o=this._localStorageAdapter(e.dataType).deleteMany(e.params),r=t.deleteMany(e.params);const s=[await o,await r];console.info("Result of deleted many from IndexedDB",s)}catch(e){console.error("Some errors happen on deleting data from IndexedDB",e.message)}}async query(e){let t=this._remoteStorageAdapter(e.dataType),o=this._localStorageAdapter(e.dataType),r=await t.query(e.params),s=await o.query(e.params);r.length>0&&o.deleteMany(params);let a=[],n=[];return s.forEach(e=>{let t=!1;for(let o=0;o<r.length;o++)if(r[o].isSameItem(e)&&(t=!0,r[o].isNotEqual(e))){let t=r[o].merge(e);r[o]=t,n.push(r[o].merge(e))}t||a.push(e)}),a.forEach(e=>{t.create(e)}),n.forEach(e=>{t.update(e)}),[...r,...a].forEach(e=>{o.create(e)}),[...r,...a]}}user_data_manager_UserDataManager.LOCAL_DRIVER_CLASSES={WordItem:worditem_indexeddb_driver_WordItemIndexedDbDriver},user_data_manager_UserDataManager.REMOTE_DRIVER_CLASSES={WordItem:class WordItemRemoteDbDriver{}},o.d(t,"Style",function(){return s.a}),o.d(t,"WordlistController",function(){return wordlist_controller_WordlistController}),o.d(t,"WordListPanel",function(){return z}),o.d(t,"UserDataManager",function(){return user_data_manager_UserDataManager})}])});