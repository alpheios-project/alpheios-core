!function webpackUniversalModuleDefinition(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t(require("alpheios-data-models"));else if("function"==typeof define&&define.amd)define(["alpheios-data-models"],t);else{var r="object"==typeof exports?t(require("alpheios-data-models")):t(e["alpheios-data-models"]);for(var o in r)("object"==typeof exports?exports:e)[o]=r[o]}}(self,(e=>(()=>{var t={486:(e,t,r)=>{e.exports=r(175)},232:(e,t,r)=>{"use strict";var o=r(948),s=r(162),a=r(65),n=r(42),i=r(214),u=r(170),d=r(632),c=r(591);e.exports=function xhrAdapter(e){return new Promise((function dispatchXhrRequest(t,r){var l=e.data,h=e.headers,m=e.responseType;o.isFormData(l)&&delete h["Content-Type"];var p=new XMLHttpRequest;if(e.auth){var g=e.auth.username||"",f=e.auth.password?unescape(encodeURIComponent(e.auth.password)):"";h.Authorization="Basic "+btoa(g+":"+f)}var y=i(e.baseURL,e.url);function onloadend(){if(p){var o="getAllResponseHeaders"in p?u(p.getAllResponseHeaders()):null,a={data:m&&"text"!==m&&"json"!==m?p.response:p.responseText,status:p.status,statusText:p.statusText,headers:o,config:e,request:p};s(t,r,a),p=null}}if(p.open(e.method.toUpperCase(),n(y,e.params,e.paramsSerializer),!0),p.timeout=e.timeout,"onloadend"in p?p.onloadend=onloadend:p.onreadystatechange=function handleLoad(){p&&4===p.readyState&&(0!==p.status||p.responseURL&&0===p.responseURL.indexOf("file:"))&&setTimeout(onloadend)},p.onabort=function handleAbort(){p&&(r(c("Request aborted",e,"ECONNABORTED",p)),p=null)},p.onerror=function handleError(){r(c("Network Error",e,null,p)),p=null},p.ontimeout=function handleTimeout(){var t="timeout of "+e.timeout+"ms exceeded";e.timeoutErrorMessage&&(t=e.timeoutErrorMessage),r(c(t,e,e.transitional&&e.transitional.clarifyTimeoutError?"ETIMEDOUT":"ECONNABORTED",p)),p=null},o.isStandardBrowserEnv()){var b=(e.withCredentials||d(y))&&e.xsrfCookieName?a.read(e.xsrfCookieName):void 0;b&&(h[e.xsrfHeaderName]=b)}"setRequestHeader"in p&&o.forEach(h,(function setRequestHeader(e,t){void 0===l&&"content-type"===t.toLowerCase()?delete h[t]:p.setRequestHeader(t,e)})),o.isUndefined(e.withCredentials)||(p.withCredentials=!!e.withCredentials),m&&"json"!==m&&(p.responseType=e.responseType),"function"==typeof e.onDownloadProgress&&p.addEventListener("progress",e.onDownloadProgress),"function"==typeof e.onUploadProgress&&p.upload&&p.upload.addEventListener("progress",e.onUploadProgress),e.cancelToken&&e.cancelToken.promise.then((function onCanceled(e){p&&(p.abort(),r(e),p=null)})),l||(l=null),p.send(l)}))}},175:(e,t,r)=>{"use strict";var o=r(948),s=r(365),a=r(262),n=r(682);function createInstance(e){var t=new a(e),r=s(a.prototype.request,t);return o.extend(r,a.prototype,t),o.extend(r,t),r}var i=createInstance(r(14));i.Axios=a,i.create=function create(e){return createInstance(n(i.defaults,e))},i.Cancel=r(280),i.CancelToken=r(521),i.isCancel=r(583),i.all=function all(e){return Promise.all(e)},i.spread=r(338),i.isAxiosError=r(646),e.exports=i,e.exports.default=i},280:e=>{"use strict";function Cancel(e){this.message=e}Cancel.prototype.toString=function toString(){return"Cancel"+(this.message?": "+this.message:"")},Cancel.prototype.__CANCEL__=!0,e.exports=Cancel},521:(e,t,r)=>{"use strict";var o=r(280);function CancelToken(e){if("function"!=typeof e)throw new TypeError("executor must be a function.");var t;this.promise=new Promise((function promiseExecutor(e){t=e}));var r=this;e((function cancel(e){r.reason||(r.reason=new o(e),t(r.reason))}))}CancelToken.prototype.throwIfRequested=function throwIfRequested(){if(this.reason)throw this.reason},CancelToken.source=function source(){var e;return{token:new CancelToken((function executor(t){e=t})),cancel:e}},e.exports=CancelToken},583:e=>{"use strict";e.exports=function isCancel(e){return!(!e||!e.__CANCEL__)}},262:(e,t,r)=>{"use strict";var o=r(948),s=r(42),a=r(5),n=r(530),i=r(682),u=r(288),d=u.validators;function Axios(e){this.defaults=e,this.interceptors={request:new a,response:new a}}Axios.prototype.request=function request(e){"string"==typeof e?(e=arguments[1]||{}).url=arguments[0]:e=e||{},(e=i(this.defaults,e)).method?e.method=e.method.toLowerCase():this.defaults.method?e.method=this.defaults.method.toLowerCase():e.method="get";var t=e.transitional;void 0!==t&&u.assertOptions(t,{silentJSONParsing:d.transitional(d.boolean,"1.0.0"),forcedJSONParsing:d.transitional(d.boolean,"1.0.0"),clarifyTimeoutError:d.transitional(d.boolean,"1.0.0")},!1);var r=[],o=!0;this.interceptors.request.forEach((function unshiftRequestInterceptors(t){"function"==typeof t.runWhen&&!1===t.runWhen(e)||(o=o&&t.synchronous,r.unshift(t.fulfilled,t.rejected))}));var s,a=[];if(this.interceptors.response.forEach((function pushResponseInterceptors(e){a.push(e.fulfilled,e.rejected)})),!o){var c=[n,void 0];for(Array.prototype.unshift.apply(c,r),c=c.concat(a),s=Promise.resolve(e);c.length;)s=s.then(c.shift(),c.shift());return s}for(var l=e;r.length;){var h=r.shift(),m=r.shift();try{l=h(l)}catch(e){m(e);break}}try{s=n(l)}catch(e){return Promise.reject(e)}for(;a.length;)s=s.then(a.shift(),a.shift());return s},Axios.prototype.getUri=function getUri(e){return e=i(this.defaults,e),s(e.url,e.params,e.paramsSerializer).replace(/^\?/,"")},o.forEach(["delete","get","head","options"],(function forEachMethodNoData(e){Axios.prototype[e]=function(t,r){return this.request(i(r||{},{method:e,url:t,data:(r||{}).data}))}})),o.forEach(["post","put","patch"],(function forEachMethodWithData(e){Axios.prototype[e]=function(t,r,o){return this.request(i(o||{},{method:e,url:t,data:r}))}})),e.exports=Axios},5:(e,t,r)=>{"use strict";var o=r(948);function InterceptorManager(){this.handlers=[]}InterceptorManager.prototype.use=function use(e,t,r){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!r&&r.synchronous,runWhen:r?r.runWhen:null}),this.handlers.length-1},InterceptorManager.prototype.eject=function eject(e){this.handlers[e]&&(this.handlers[e]=null)},InterceptorManager.prototype.forEach=function forEach(e){o.forEach(this.handlers,(function forEachHandler(t){null!==t&&e(t)}))},e.exports=InterceptorManager},214:(e,t,r)=>{"use strict";var o=r(713),s=r(671);e.exports=function buildFullPath(e,t){return e&&!o(t)?s(e,t):t}},591:(e,t,r)=>{"use strict";var o=r(475);e.exports=function createError(e,t,r,s,a){var n=new Error(e);return o(n,t,r,s,a)}},530:(e,t,r)=>{"use strict";var o=r(948),s=r(587),a=r(583),n=r(14);function throwIfCancellationRequested(e){e.cancelToken&&e.cancelToken.throwIfRequested()}e.exports=function dispatchRequest(e){return throwIfCancellationRequested(e),e.headers=e.headers||{},e.data=s.call(e,e.data,e.headers,e.transformRequest),e.headers=o.merge(e.headers.common||{},e.headers[e.method]||{},e.headers),o.forEach(["delete","get","head","post","put","patch","common"],(function cleanHeaderConfig(t){delete e.headers[t]})),(e.adapter||n.adapter)(e).then((function onAdapterResolution(t){return throwIfCancellationRequested(e),t.data=s.call(e,t.data,t.headers,e.transformResponse),t}),(function onAdapterRejection(t){return a(t)||(throwIfCancellationRequested(e),t&&t.response&&(t.response.data=s.call(e,t.response.data,t.response.headers,e.transformResponse))),Promise.reject(t)}))}},475:e=>{"use strict";e.exports=function enhanceError(e,t,r,o,s){return e.config=t,r&&(e.code=r),e.request=o,e.response=s,e.isAxiosError=!0,e.toJSON=function toJSON(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code}},e}},682:(e,t,r)=>{"use strict";var o=r(948);e.exports=function mergeConfig(e,t){t=t||{};var r={},s=["url","method","data"],a=["headers","auth","proxy","params"],n=["baseURL","transformRequest","transformResponse","paramsSerializer","timeout","timeoutMessage","withCredentials","adapter","responseType","xsrfCookieName","xsrfHeaderName","onUploadProgress","onDownloadProgress","decompress","maxContentLength","maxBodyLength","maxRedirects","transport","httpAgent","httpsAgent","cancelToken","socketPath","responseEncoding"],i=["validateStatus"];function getMergedValue(e,t){return o.isPlainObject(e)&&o.isPlainObject(t)?o.merge(e,t):o.isPlainObject(t)?o.merge({},t):o.isArray(t)?t.slice():t}function mergeDeepProperties(s){o.isUndefined(t[s])?o.isUndefined(e[s])||(r[s]=getMergedValue(void 0,e[s])):r[s]=getMergedValue(e[s],t[s])}o.forEach(s,(function valueFromConfig2(e){o.isUndefined(t[e])||(r[e]=getMergedValue(void 0,t[e]))})),o.forEach(a,mergeDeepProperties),o.forEach(n,(function defaultToConfig2(s){o.isUndefined(t[s])?o.isUndefined(e[s])||(r[s]=getMergedValue(void 0,e[s])):r[s]=getMergedValue(void 0,t[s])})),o.forEach(i,(function merge(o){o in t?r[o]=getMergedValue(e[o],t[o]):o in e&&(r[o]=getMergedValue(void 0,e[o]))}));var u=s.concat(a).concat(n).concat(i),d=Object.keys(e).concat(Object.keys(t)).filter((function filterAxiosKeys(e){return-1===u.indexOf(e)}));return o.forEach(d,mergeDeepProperties),r}},162:(e,t,r)=>{"use strict";var o=r(591);e.exports=function settle(e,t,r){var s=r.config.validateStatus;r.status&&s&&!s(r.status)?t(o("Request failed with status code "+r.status,r.config,null,r.request,r)):e(r)}},587:(e,t,r)=>{"use strict";var o=r(948),s=r(14);e.exports=function transformData(e,t,r){var a=this||s;return o.forEach(r,(function transform(r){e=r.call(a,e,t)})),e}},14:(e,t,r)=>{"use strict";var o=r(948),s=r(236),a=r(475),n={"Content-Type":"application/x-www-form-urlencoded"};function setContentTypeIfUnset(e,t){!o.isUndefined(e)&&o.isUndefined(e["Content-Type"])&&(e["Content-Type"]=t)}var i={transitional:{silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},adapter:function getDefaultAdapter(){var e;return("undefined"!=typeof XMLHttpRequest||"undefined"!=typeof process&&"[object process]"===Object.prototype.toString.call(process))&&(e=r(232)),e}(),transformRequest:[function transformRequest(e,t){return s(t,"Accept"),s(t,"Content-Type"),o.isFormData(e)||o.isArrayBuffer(e)||o.isBuffer(e)||o.isStream(e)||o.isFile(e)||o.isBlob(e)?e:o.isArrayBufferView(e)?e.buffer:o.isURLSearchParams(e)?(setContentTypeIfUnset(t,"application/x-www-form-urlencoded;charset=utf-8"),e.toString()):o.isObject(e)||t&&"application/json"===t["Content-Type"]?(setContentTypeIfUnset(t,"application/json"),function stringifySafely(e,t,r){if(o.isString(e))try{return(t||JSON.parse)(e),o.trim(e)}catch(e){if("SyntaxError"!==e.name)throw e}return(r||JSON.stringify)(e)}(e)):e}],transformResponse:[function transformResponse(e){var t=this.transitional,r=t&&t.silentJSONParsing,s=t&&t.forcedJSONParsing,n=!r&&"json"===this.responseType;if(n||s&&o.isString(e)&&e.length)try{return JSON.parse(e)}catch(e){if(n){if("SyntaxError"===e.name)throw a(e,this,"E_JSON_PARSE");throw e}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,validateStatus:function validateStatus(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};o.forEach(["delete","get","head"],(function forEachMethodNoData(e){i.headers[e]={}})),o.forEach(["post","put","patch"],(function forEachMethodWithData(e){i.headers[e]=o.merge(n)})),e.exports=i},365:e=>{"use strict";e.exports=function bind(e,t){return function wrap(){for(var r=new Array(arguments.length),o=0;o<r.length;o++)r[o]=arguments[o];return e.apply(t,r)}}},42:(e,t,r)=>{"use strict";var o=r(948);function encode(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}e.exports=function buildURL(e,t,r){if(!t)return e;var s;if(r)s=r(t);else if(o.isURLSearchParams(t))s=t.toString();else{var a=[];o.forEach(t,(function serialize(e,t){null!=e&&(o.isArray(e)?t+="[]":e=[e],o.forEach(e,(function parseValue(e){o.isDate(e)?e=e.toISOString():o.isObject(e)&&(e=JSON.stringify(e)),a.push(encode(t)+"="+encode(e))})))})),s=a.join("&")}if(s){var n=e.indexOf("#");-1!==n&&(e=e.slice(0,n)),e+=(-1===e.indexOf("?")?"?":"&")+s}return e}},671:e=>{"use strict";e.exports=function combineURLs(e,t){return t?e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,""):e}},65:(e,t,r)=>{"use strict";var o=r(948);e.exports=o.isStandardBrowserEnv()?function standardBrowserEnv(){return{write:function write(e,t,r,s,a,n){var i=[];i.push(e+"="+encodeURIComponent(t)),o.isNumber(r)&&i.push("expires="+new Date(r).toGMTString()),o.isString(s)&&i.push("path="+s),o.isString(a)&&i.push("domain="+a),!0===n&&i.push("secure"),document.cookie=i.join("; ")},read:function read(e){var t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove:function remove(e){this.write(e,"",Date.now()-864e5)}}}():{write:function write(){},read:function read(){return null},remove:function remove(){}}},713:e=>{"use strict";e.exports=function isAbsoluteURL(e){return/^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(e)}},646:e=>{"use strict";e.exports=function isAxiosError(e){return"object"==typeof e&&!0===e.isAxiosError}},632:(e,t,r)=>{"use strict";var o=r(948);e.exports=o.isStandardBrowserEnv()?function standardBrowserEnv(){var e,t=/(msie|trident)/i.test(navigator.userAgent),r=document.createElement("a");function resolveURL(e){var o=e;return t&&(r.setAttribute("href",o),o=r.href),r.setAttribute("href",o),{href:r.href,protocol:r.protocol?r.protocol.replace(/:$/,""):"",host:r.host,search:r.search?r.search.replace(/^\?/,""):"",hash:r.hash?r.hash.replace(/^#/,""):"",hostname:r.hostname,port:r.port,pathname:"/"===r.pathname.charAt(0)?r.pathname:"/"+r.pathname}}return e=resolveURL(window.location.href),function isURLSameOrigin(t){var r=o.isString(t)?resolveURL(t):t;return r.protocol===e.protocol&&r.host===e.host}}():function isURLSameOrigin(){return!0}},236:(e,t,r)=>{"use strict";var o=r(948);e.exports=function normalizeHeaderName(e,t){o.forEach(e,(function processHeader(r,o){o!==t&&o.toUpperCase()===t.toUpperCase()&&(e[t]=r,delete e[o])}))}},170:(e,t,r)=>{"use strict";var o=r(948),s=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];e.exports=function parseHeaders(e){var t,r,a,n={};return e?(o.forEach(e.split("\n"),(function parser(e){if(a=e.indexOf(":"),t=o.trim(e.substr(0,a)).toLowerCase(),r=o.trim(e.substr(a+1)),t){if(n[t]&&s.indexOf(t)>=0)return;n[t]="set-cookie"===t?(n[t]?n[t]:[]).concat([r]):n[t]?n[t]+", "+r:r}})),n):n}},338:e=>{"use strict";e.exports=function spread(e){return function wrap(t){return e.apply(null,t)}}},288:(e,t,r)=>{"use strict";var o=r(837),s={};["object","boolean","number","function","string","symbol"].forEach((function(e,t){s[e]=function validator(r){return typeof r===e||"a"+(t<1?"n ":" ")+e}}));var a={},n=o.version.split(".");function isOlderVersion(e,t){for(var r=t?t.split("."):n,o=e.split("."),s=0;s<3;s++){if(r[s]>o[s])return!0;if(r[s]<o[s])return!1}return!1}s.transitional=function transitional(e,t,r){var s=t&&isOlderVersion(t);function formatMessage(e,t){return"[Axios v"+o.version+"] Transitional option '"+e+"'"+t+(r?". "+r:"")}return function(r,o,n){if(!1===e)throw new Error(formatMessage(o," has been removed in "+t));return s&&!a[o]&&(a[o]=!0,console.warn(formatMessage(o," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(r,o,n)}},e.exports={isOlderVersion,assertOptions:function assertOptions(e,t,r){if("object"!=typeof e)throw new TypeError("options must be an object");for(var o=Object.keys(e),s=o.length;s-- >0;){var a=o[s],n=t[a];if(n){var i=e[a],u=void 0===i||n(i,a,e);if(!0!==u)throw new TypeError("option "+a+" must be "+u)}else if(!0!==r)throw Error("Unknown option "+a)}},validators:s}},948:(e,t,r)=>{"use strict";var o=r(365),s=Object.prototype.toString;function isArray(e){return"[object Array]"===s.call(e)}function isUndefined(e){return void 0===e}function isObject(e){return null!==e&&"object"==typeof e}function isPlainObject(e){if("[object Object]"!==s.call(e))return!1;var t=Object.getPrototypeOf(e);return null===t||t===Object.prototype}function isFunction(e){return"[object Function]"===s.call(e)}function forEach(e,t){if(null!=e)if("object"!=typeof e&&(e=[e]),isArray(e))for(var r=0,o=e.length;r<o;r++)t.call(null,e[r],r,e);else for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.call(null,e[s],s,e)}e.exports={isArray,isArrayBuffer:function isArrayBuffer(e){return"[object ArrayBuffer]"===s.call(e)},isBuffer:function isBuffer(e){return null!==e&&!isUndefined(e)&&null!==e.constructor&&!isUndefined(e.constructor)&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)},isFormData:function isFormData(e){return"undefined"!=typeof FormData&&e instanceof FormData},isArrayBufferView:function isArrayBufferView(e){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&e.buffer instanceof ArrayBuffer},isString:function isString(e){return"string"==typeof e},isNumber:function isNumber(e){return"number"==typeof e},isObject,isPlainObject,isUndefined,isDate:function isDate(e){return"[object Date]"===s.call(e)},isFile:function isFile(e){return"[object File]"===s.call(e)},isBlob:function isBlob(e){return"[object Blob]"===s.call(e)},isFunction,isStream:function isStream(e){return isObject(e)&&isFunction(e.pipe)},isURLSearchParams:function isURLSearchParams(e){return"undefined"!=typeof URLSearchParams&&e instanceof URLSearchParams},isStandardBrowserEnv:function isStandardBrowserEnv(){return("undefined"==typeof navigator||"ReactNative"!==navigator.product&&"NativeScript"!==navigator.product&&"NS"!==navigator.product)&&("undefined"!=typeof window&&"undefined"!=typeof document)},forEach,merge:function merge(){var e={};function assignValue(t,r){isPlainObject(e[r])&&isPlainObject(t)?e[r]=merge(e[r],t):isPlainObject(t)?e[r]=merge({},t):isArray(t)?e[r]=t.slice():e[r]=t}for(var t=0,r=arguments.length;t<r;t++)forEach(arguments[t],assignValue);return e},extend:function extend(e,t,r){return forEach(t,(function assignValue(t,s){e[s]=r&&"function"==typeof t?o(t,r):t})),e},trim:function trim(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")},stripBOM:function stripBOM(e){return 65279===e.charCodeAt(0)&&(e=e.slice(1)),e}}},219:t=>{"use strict";t.exports=e},837:e=>{"use strict";e.exports=JSON.parse('{"name":"axios","version":"0.21.4","description":"Promise based HTTP client for the browser and node.js","main":"index.js","scripts":{"test":"grunt test","start":"node ./sandbox/server.js","build":"NODE_ENV=production grunt build","preversion":"npm test","version":"npm run build && grunt version && git add -A dist && git add CHANGELOG.md bower.json package.json","postversion":"git push && git push --tags","examples":"node ./examples/server.js","coveralls":"cat coverage/lcov.info | ./node_modules/coveralls/bin/coveralls.js","fix":"eslint --fix lib/**/*.js"},"repository":{"type":"git","url":"https://github.com/axios/axios.git"},"keywords":["xhr","http","ajax","promise","node"],"author":"Matt Zabriskie","license":"MIT","bugs":{"url":"https://github.com/axios/axios/issues"},"homepage":"https://axios-http.com","devDependencies":{"coveralls":"^3.0.0","es6-promise":"^4.2.4","grunt":"^1.3.0","grunt-banner":"^0.6.0","grunt-cli":"^1.2.0","grunt-contrib-clean":"^1.1.0","grunt-contrib-watch":"^1.0.0","grunt-eslint":"^23.0.0","grunt-karma":"^4.0.0","grunt-mocha-test":"^0.13.3","grunt-ts":"^6.0.0-beta.19","grunt-webpack":"^4.0.2","istanbul-instrumenter-loader":"^1.0.0","jasmine-core":"^2.4.1","karma":"^6.3.2","karma-chrome-launcher":"^3.1.0","karma-firefox-launcher":"^2.1.0","karma-jasmine":"^1.1.1","karma-jasmine-ajax":"^0.1.13","karma-safari-launcher":"^1.0.0","karma-sauce-launcher":"^4.3.6","karma-sinon":"^1.0.5","karma-sourcemap-loader":"^0.3.8","karma-webpack":"^4.0.2","load-grunt-tasks":"^3.5.2","minimist":"^1.2.0","mocha":"^8.2.1","sinon":"^4.5.0","terser-webpack-plugin":"^4.2.3","typescript":"^4.0.5","url-search-params":"^0.10.0","webpack":"^4.44.2","webpack-dev-server":"^3.11.0"},"browser":{"./lib/adapters/http.js":"./lib/adapters/xhr.js"},"jsdelivr":"dist/axios.min.js","unpkg":"dist/axios.min.js","typings":"./index.d.ts","dependencies":{"follow-redirects":"^1.14.0"},"bundlesize":[{"path":"./dist/axios.min.js","threshold":"5kB"}]}')}},r={};function __webpack_require__(e){var o=r[e];if(void 0!==o)return o.exports;var s=r[e]={exports:{}};return t[e](s,s.exports,__webpack_require__),s.exports}__webpack_require__.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return __webpack_require__.d(t,{a:t}),t},__webpack_require__.d=(e,t)=>{for(var r in t)__webpack_require__.o(t,r)&&!__webpack_require__.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},__webpack_require__.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),__webpack_require__.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var o={};return(()=>{"use strict";__webpack_require__.r(o),__webpack_require__.d(o,{UserDataManager:()=>UserDataManager,WordlistController:()=>WordlistController});var e=__webpack_require__(219);class Utility{static get currentDate(){let e=new Date;return e.getFullYear()+"/"+(e.getMonth()+1<10?"0":"")+(e.getMonth()+1)+"/"+(e.getDate()<10?"0":"")+e.getDate()+" @ "+(e.getHours()<10?"0":"")+e.getHours()+":"+(e.getMinutes()<10?"0":"")+e.getMinutes()+":"+(e.getSeconds()<10?"0":"")+e.getSeconds()}}class WordlistController{constructor(e,t){this.wordLists={},this.availableLangs=e,t.TEXT_QUOTE_SELECTOR_RECEIVED.sub(this.onTextQuoteSelectorReceived.bind(this)),t.HOMONYM_READY.sub(this.onHomonymReady.bind(this)),t.SHORT_DEFS_READY.sub(this.onDefinitionsReady.bind(this)),t.FULL_DEFS_READY.sub(this.onDefinitionsReady.bind(this)),t.LEMMA_TRANSL_READY.sub(this.onLemmaTranslationsReady.bind(this)),t.WORDLIST_UPDATE_HOMONYM_READY.sub(this.onHomonymReadyForWordlistUpdate.bind(this)),t.WORDLIST_UPDATE_LEMMA_TRANSL_READY.sub(this.onLemmaTranslationsReadyForWordlistUpdate.bind(this)),t.WORDLIST_UPDATE_SHORT_DEFS_READY.sub(this.onDefinitionsReadyForWordlistUpdate.bind(this))}async initLists(t){if(t)for(let r of this.availableLangs){let o=this.wordLists[r];delete this.wordLists[r];let s=await t.query({dataType:"WordItem",params:{languageCode:r}},{syncDelete:!0});if(s.length>0&&(this.wordLists[r]=new e.WordList(r,s),WordlistController.evt.WORDLIST_UPDATED.pub(this.wordLists)),o)for(let t of o.values)try{let r=t.context.map((t=>new e.TextQuoteSelector(t.languageCode,t.normalizedText,t.prefix,t.suffix,t.source)));for(let e of r)this.onTextQuoteSelectorReceived(e);t.homonym&&this.onHomonymReady(t.homonym)}catch(t){e.Logger.getInstance().error("Alpheios error: unexpected error replaying cached wordlist item",t)}}else this.wordLists={};return this.wordLists}getWordListItemCount(){let e=0;for(let t of this.availableLangs)this.wordLists[t]&&(e+=this.wordLists[t].size);return e}getWordList(t,r=!0){if(r&&!this._wordListExist(t)){let r=new e.WordList(t,[]);this.wordLists[t]=r,WordlistController.evt.WORDLIST_CREATED.pub(r)}return this.wordLists[t]}removeWordList(e){delete this.wordLists[e],WordlistController.evt.WORDLIST_DELETED.pub({dataType:"WordItem",params:{languageCode:e}}),WordlistController.evt.WORDLIST_UPDATED.pub(this.wordLists)}removeWordListItem(t,r){let o=this.getWordList(t,!1);if(o){let s=o.deleteWordItem(r);s?(WordlistController.evt.WORDITEM_DELETED.pub({dataObj:s}),o.isEmpty&&this.removeWordList(t)):e.Logger.getInstance().error("Alpheios error: unexpected error updating user wordlist: trying to delete an absent element")}}getWordListItem(t,r,o=!1){let s,a=this.getWordList(t,o);return a&&(s=a.getWordItem(r,o,WordlistController.evt.WORDITEM_UPDATED),o&&(s.createdDT=Utility.currentDate)),s||e.Logger.getInstance().error(`Alpheios error: wordlist item not found: ${t} ${r}`),s}onHomonymReady(t){let r=this.getWordListItem(e.LanguageModelFactory.getLanguageCodeFromId(t.languageID),t.targetWord,!0);r.homonym=t,r.currentSession=!0,r.updatedDT=Utility.currentDate,r.frequency=r.frequency?r.frequency+1:1,WordlistController.evt.WORDITEM_UPDATED.pub({dataObj:r,params:{segment:"common"}}),WordlistController.evt.WORDITEM_UPDATED.pub({dataObj:r,params:{segment:"shortHomonym"}}),WordlistController.evt.WORDLIST_UPDATED.pub(this.wordLists)}onHomonymReadyForWordlistUpdate(t){let r=this.getWordListItem(e.LanguageModelFactory.getLanguageCodeFromId(t.languageID),t.targetWord,!0);r.homonym=t,WordlistController.evt.WORDITEM_UPDATED.pub({dataObj:r,params:{segment:"common"}}),WordlistController.evt.WORDITEM_UPDATED.pub({dataObj:r,params:{segment:"shortHomonym"}}),WordlistController.evt.WORDLIST_UPDATED.pub(this.wordLists)}onDefinitionsReady(t){let r=this.getWordListItem(e.LanguageModelFactory.getLanguageCodeFromId(t.homonym.languageID),t.homonym.targetWord);r?(r.currentSession=!0,r.updatedDT=Utility.currentDate,r.homonym=t.homonym,WordlistController.evt.WORDITEM_UPDATED.pub({dataObj:r,params:{segment:"fullHomonym"}})):e.Logger.getInstance().error("Alpheios error: unexpected error updating user word list: request to add definitions to non-existent item.")}onDefinitionsReadyForWordlistUpdate(t){let r=this.getWordListItem(e.LanguageModelFactory.getLanguageCodeFromId(t.homonym.languageID),t.homonym.targetWord);r?(r.homonym=t.homonym,WordlistController.evt.WORDITEM_UPDATED.pub({dataObj:r,params:{segment:"fullHomonym"}})):console.error("Alpheios error: unexpected error updating user word list: request to add definitions to non-existent item.")}onLemmaTranslationsReady(t){let r=this.getWordListItem(e.LanguageModelFactory.getLanguageCodeFromId(t.languageID),t.targetWord);r?(r.currentSession=!0,r.updatedDT=Utility.currentDate,r.homonym=t,WordlistController.evt.WORDITEM_UPDATED.pub({dataObj:r,params:{segment:"fullHomonym"}})):e.Logger.getInstance().error("Alpheios error: unexpected error updating user word list: request to add translations to non-existent item")}onLemmaTranslationsReadyForWordlistUpdate(t){let r=this.getWordListItem(e.LanguageModelFactory.getLanguageCodeFromId(t.languageID),t.targetWord);r?(r.homonym=t,WordlistController.evt.WORDITEM_UPDATED.pub({dataObj:r,params:{segment:"fullHomonym"}})):console.error("Alpheios error: unexpected error updating user word list: request to add translations to non-existent item")}onTextQuoteSelectorReceived(t){let r=this.getWordListItem(t.languageCode,t.normalizedText,!0);r?(r.currentSession=!0,r.updatedDT=Utility.currentDate,r.addContext([t]),WordlistController.evt.WORDITEM_UPDATED.pub({dataObj:r,params:{segment:"context"}}),WordlistController.evt.WORDLIST_UPDATED.pub([this.getWordList(r.languageCode)])):e.Logger.getInstance().error("Alpheios error: unexpected error updating user word list: unable to create or retrieve worditem")}updateWordItemImportant(t,r,o){let s=this.getWordListItem(t,r,!1);s?(s.important=o,s.updatedDT=Utility.currentDate,WordlistController.evt.WORDITEM_UPDATED.pub({dataObj:s,params:{segment:"common"}})):e.Logger.getInstance().error("Alpheios error: unexpected error updating user word list: request to set important flag on non-existent item")}updateAllImportant(e,t){this.getWordList(e,!1).values.forEach((e=>{e.important=t,e.updatedDT=Utility.currentDate,WordlistController.evt.WORDITEM_UPDATED.pub({dataObj:e,params:{segment:"common"}})}))}async selectWordItem(e,t){let r=this.getWordListItem(e,t,!1);WordlistController.evt.WORDITEM_SELECTED.pub(r)}_wordListExist(e){return Object.keys(this.wordLists).includes(e)}}WordlistController.evt={WORDLIST_UPDATED:new e.PsEvent("Wordlist updated",WordlistController),WORDLIST_CREATED:new e.PsEvent("Wordlist created",WordlistController),WORDLIST_DELETED:new e.PsEvent("Wordlist deleted",WordlistController),WORDITEM_SELECTED:new e.PsEvent("WordItem selected",WordlistController),WORDITEM_UPDATED:new e.PsEvent("WordItem updated",WordlistController),WORDITEM_DELETED:new e.PsEvent("WordItem deleted",WordlistController)};class IndexedDBObjectStoresStructure{static _objectStoreTemplate(){return{keyPath:"ID",indexes:[{indexName:"ID",keyPath:"ID",unique:!0},{indexName:"listID",keyPath:"listID",unique:!1},{indexName:"userID",keyPath:"userID",unique:!1},{indexName:"languageCode",keyPath:"languageCode",unique:!1},{indexName:"targetWord",keyPath:"targetWord",unique:!1}]}}static get WordListsCommon(){return IndexedDBObjectStoresStructure._objectStoreTemplate()}static get WordListsContext(){let e=IndexedDBObjectStoresStructure._objectStoreTemplate();return e.indexes.push({indexName:"wordItemID",keyPath:"wordItemID",unique:!1}),e}static get WordListsHomonym(){return IndexedDBObjectStoresStructure._objectStoreTemplate()}static get WordListsFullHomonym(){return IndexedDBObjectStoresStructure._objectStoreTemplate()}}class IndexedDBLoadProcess{static loadBaseObject(t){return t.currentSession=!1,new e.WordItem(t)}static loadContext(t,r){return Array.isArray(t)||(t=[t]),r.context=e.WordItem.readContext(t),r}static loadHomonym(t,r){let o=t[0].homonym;if(o.lexemes&&Array.isArray(o.lexemes)&&o.lexemes.length>0)r.homonym=e.WordItem.readHomonym(t[0]);else{let s=e.LanguageModelFactory.getLanguageIdFromCode(t[0].languageCode),a=[];if(o.lemmasList){let t=o.lemmasList.split(", ");for(let r of t)a.push(new e.Lexeme(new e.Lemma(r,s),[]))}else a=[new e.Lexeme(new e.Lemma(t[0].targetWord,s),[])];r.homonym=new e.Homonym(a,o.targetWord)}return r}}class WordItemIndexedDbDriver{constructor(e){this.userId=e,this.storageMap={_loadFirst:"common",common:{type:"segment",sync:!0,objectStoreData:{name:"WordListsCommon",structure:IndexedDBObjectStoresStructure.WordListsCommon},load:IndexedDBLoadProcess.loadBaseObject,serialize:this._serializeCommon.bind(this),delete:this._segmentSelectQueryByID.bind(this),select:this._segmentSelectQueryByID.bind(this)},context:{type:"segment",sync:!0,objectStoreData:{name:"WordListsContext",structure:IndexedDBObjectStoresStructure.WordListsContext},serialize:this._serializeContext.bind(this),load:IndexedDBLoadProcess.loadContext,delete:this._segmentSelectQueryByWordItemID.bind(this),select:this._segmentSelectQueryByWordItemID.bind(this)},shortHomonym:{type:"segment",sync:!0,objectStoreData:{name:"WordListsHomonym",structure:IndexedDBObjectStoresStructure.WordListsHomonym},serialize:this._serializeHomonym.bind(this),load:IndexedDBLoadProcess.loadHomonym,delete:this._segmentSelectQueryByID.bind(this),select:this._segmentSelectQueryByID.bind(this)},fullHomonym:{type:"segment",objectStoreData:{name:"WordListsFullHomonym",structure:IndexedDBObjectStoresStructure.WordListsFullHomonym},serialize:this._serializeHomonymWithFullDefs.bind(this),load:IndexedDBLoadProcess.loadHomonym,delete:this._segmentSelectQueryByID.bind(this),select:this._segmentSelectQueryByID.bind(this)}}}get dbName(){return"AlpheiosWordLists"}get dbVersion(){return 3}get segmentsSync(){return Object.keys(this.storageMap).filter((e=>"segment"===this.storageMap[e].type&&this.storageMap[e].sync))}get segments(){return Object.keys(this.storageMap).filter((e=>"segment"===this.storageMap[e].type))}get segmentsNotFirst(){return this.segments.filter((e=>e!==this.storageMap._loadFirst))}get objectStores(){return this.allObjectStoreData.map((e=>e.name))}get allObjectStoreData(){return this.segments.map((e=>this.storageMap[e].objectStoreData))}_objectStoreData(e){return this.storageMap[e].objectStoreData}_formatQuery(e,t){return{objectStoreName:this._objectStoreData(e).name,condition:t}}_selectByID(e,t="only"){return{indexName:"ID",value:this._makeStorageID(e),type:t}}_selectByWordItemID(e,t="only"){return{indexName:"wordItemID",value:this._makeStorageID(e),type:t}}_selectByListID(e,t="only"){return{indexName:"listID",value:this._makeStorageListID(e),type:t}}loadFirst(e){return this.loadSegment(this.storageMap._loadFirst,e)}loadSegment(e,t,r){if(this.storageMap[e].load)return this.storageMap[e].load(t,r)}listItemsQuery(e){if(e.languageCode)return this._formatQuery("common",this._selectByListID(e.languageCode));if(e.wordItem)return this._formatQuery("common",this._selectByID(e.wordItem));throw new Error("Invalid query parameters - missing languageCode")}segmentSelectQuery(e,t){if(this.storageMap[e].select)return this.storageMap[e].select(e,t)}_segmentSelectQueryByWordItemID(e,t){return this._formatQuery(e,this._selectByWordItemID(t))}_segmentSelectQueryByID(e,t){return this._formatQuery(e,this._selectByID(t))}segmentDeleteQuery(e,t){if(this.storageMap[e].delete)return this.storageMap[e].delete(e,t)}segmentDeleteManyQuery(e,t){if(t.languageCode)return this._formatQuery(e,this._selectByListID(t.languageCode));throw new Error("Invalid query parameters - missing languageCode")}updateSegmentQuery(e,t){return{objectStoreName:this._objectStoreData(e).name,dataItems:this.storageMap[e].serialize(t)}}_serializeCommon(e){return[{ID:this._makeStorageID(e),listID:this.userId+"-"+e.languageCode,userID:this.userId,languageCode:e.languageCode,targetWord:e.targetWord,important:e.important,createdDT:e.createdDT?e.createdDT:Utility.currentDate,updatedDT:e.updatedDT,frequency:e.frequency}]}_serializeContext(e){let t=[],r=0,o=this._makeStorageID(e);for(let s of e.context){r++;let a={ID:o+"-"+r,listID:this.userId+"-"+e.languageCode,userID:this.userId,languageCode:e.languageCode,targetWord:e.targetWord,wordItemID:o,target:{source:s.source,selector:{type:"TextQuoteSelector",exact:s.text,prefix:s.prefix&&s.prefix.length>0?s.prefix:" ",suffix:s.suffix&&s.suffix.length>0?s.suffix:" ",contextHTML:s.contextHTML,languageCode:s.languageCode}},createdDT:WordItemIndexedDbDriver.currentDate};t.push(a)}return t}_serializeHomonym(t,r=!1){let o=t.homonym&&t.homonym instanceof e.Homonym?t.homonym.convertToJSONObject(r):null;return o?[{ID:this._makeStorageID(t),listID:this.userId+"-"+t.languageCode,userID:this.userId,languageCode:t.languageCode,targetWord:t.targetWord,homonym:o}]:[]}_serializeHomonymWithFullDefs(e){return this._serializeHomonym(e,!0)}_makeStorageID(e){return this.userId+"-"+e.languageCode+"-"+e.targetWord}_makeStorageListID(e){return this.userId+"-"+e}makeIDCompareWithRemote(e){return e.languageCode+"-"+e.targetWord}getCheckArray(e){return e.map((e=>this.makeIDCompareWithRemote(e)))}createFromRemoteData(e){let t=this.loadFirst(e);return e.context&&this.loadSegment("context",e.context,t),e.homonym&&this.loadSegment("shortHomonym",[e],t),t}}class IndexedDBAdapter{constructor(e){this.available=this._initIndexedDBNamespaces(),this.dbDriver=e,this.errors=[]}async checkAndUpdate(t,r,o){if(("context"===r||!r)&&o.length>0&&o[0].context&&Array.isArray(o[0].context)){t.context=[];for(let r of o[0].context)t.context.push(e.WordItem.readContext([r])[0])}return r||(r=this.dbDriver.segmentsSync),await this.update(t,{segment:"common"}),await this.update(t,{segment:r})}async create(e){try{let t,r=this.dbDriver.segments;for(let o of r)if(t=await this.update(e,{segment:o}),!t)throw new Error(`Unknown problems with updating segment ${o}`);return t>0}catch(e){return e&&this.errors.push(e),!1}}async deleteMany(e){try{let t={};for(let r of this.dbDriver.segments){let o=this.dbDriver.segmentDeleteManyQuery(r,e),s=await this._deleteFromStore(o);t[r]=s}return t}catch(e){return e&&this.errors.push(e),!1}}async deleteOne(e){try{for(let t of this.dbDriver.segments){let r=this.dbDriver.segmentDeleteQuery(t,e);await this._deleteFromStore(r)}return!0}catch(e){return e&&this.errors.push(e),!1}}async update(e,t){try{let r,o=t&&t.segment?Array.isArray(t.segment)?t.segment:[t.segment]:[];0===o.length&&(o=this.dbDriver.segments);for(let t of o){let o=this.dbDriver.updateSegmentQuery(t,e);r=!(o.dataItems&&o.dataItems.length>0)||await this._set(o)}return r}catch(e){return void(e&&this.errors.push(e))}}async query(e){try{let t=this.dbDriver.listItemsQuery(e),r=await this._getFromStore(t),o=[];for(let e of r){let t=this.dbDriver.loadFirst(e);for(let e of this.dbDriver.segmentsNotFirst){let r=this.dbDriver.segmentSelectQuery(e,t),o=await this._getFromStore(r);o.length>0&&this.dbDriver.loadSegment(e,o,t)}o.push(t)}return o}catch(e){return e&&this.errors.push(e),!1}}async clear(){let e=this;return await new Promise(((t,r)=>{let o=e.indexedDB.open(e.dbDriver.dbName,e.dbDriver.dbVersion);o.onsuccess=o=>{try{let s=o.target.result,a=e.dbDriver.objectStores,n=a.length;for(let o of a){let a=s.transaction([o],"readwrite").objectStore(o).clear();a.onsuccess=function(e){n-=1,0===n&&t(!0)},a.onerror=function(t){e.errors.push(t.target),r(t.target)}}}catch(t){e.errors.push(t),r(t)}},o.onerror=t=>{e.errors.push(t.target),r(t.target)}}))}_initIndexedDBNamespaces(){return this.indexedDB=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB,this.IDBTransaction=window.IDBTransaction||window.webkitIDBTransaction||window.msIDBTransaction||{READ_WRITE:"readwrite"},this.IDBKeyRange=window.IDBKeyRange||window.webkitIDBKeyRange||window.msIDBKeyRange,!!this.indexedDB||(e.Logger.getInstance().warn("Alpheios warn: your browser doesn't support IndexedDB. Wordlists will not be available."),!1)}_openDatabaseRequest(){let e=this.indexedDB.open(this.dbDriver.dbName,this.dbDriver.dbVersion);return e.onupgradeneeded=e=>{const t=e.target.result,r=e.target.transaction;this._createObjectStores(t,r)},e}_createObjectStores(e,t){try{for(let r of this.dbDriver.allObjectStoreData){let o;o=e.objectStoreNames.contains(r.name)?t.objectStore(r.name):e.createObjectStore(r.name,{keyPath:r.structure.keyPath}),r.structure.indexes.forEach((e=>{o.indexNames.contains(e.indexName)||o.createIndex(e.indexName,e.keyPath,{unique:e.unique})}))}}catch(e){this.errors.push(e)}}async _set(e){let t=this;return await new Promise(((r,o)=>{let s=this._openDatabaseRequest();s.onsuccess=async t=>{const o=t.target.result;let s=await this._putItem(o,e);r(s)},s.onerror=e=>{t.errors.push(e.target),o()}}))}async _putItem(e,t){let r=this;return await new Promise(((o,s)=>{try{const a=e.transaction([t.objectStoreName],"readwrite");a.onerror=e=>{r.errors.push(e.target),s()};const n=a.objectStore(t.objectStoreName);let i=t.dataItems.length;for(let e of t.dataItems){const t=n.put(e);t.onsuccess=()=>{i-=1,0===i&&o(!0)},t.onerror=()=>{r.errors.push(event.target),s()}}0===i&&o(!0)}catch(e){if(e)return void r.errors.push(e)}}))}async _getFromStore(e){let t=this;return await new Promise(((r,o)=>{let s=this._openDatabaseRequest();s.onsuccess=s=>{try{const a=s.target.result.transaction([e.objectStoreName]),n=a.objectStore(e.objectStoreName).index(e.condition.indexName),i=this.IDBKeyRange[e.condition.type](e.condition.value),u=n.getAll(i,0);u.onsuccess=e=>{r(e.target.result)},u.onerror=e=>{t.errors.push(e.target),o()}}catch(e){t.errors.push(e),o()}},s.onerror=e=>{o(e.target)}}))}async _deleteFromStore(e){let t=this;return await new Promise(((r,o)=>{let s=this._openDatabaseRequest();s.onsuccess=s=>{try{const a=s.target.result.transaction([e.objectStoreName],"readwrite"),n=a.objectStore(e.objectStoreName).index(e.condition.indexName),i=this.IDBKeyRange[e.condition.type](e.condition.value);let u=n.openCursor(i),d=0;u.onsuccess=e=>{const s=e.target.result;if(s){const e=s.delete();e.onerror=e=>{t.errors.push(e.target),o()},e.onsuccess=e=>{d+=1},s.continue()}else r(d)}}catch(e){t.errors.push(e),o()}},s.onerror=e=>{t.errors.push(e.target),o()}}))}}var t=__webpack_require__(486),r=__webpack_require__.n(t);class RemoteDBAdapter{constructor(e){this.dbDriver=e,this.available=this._checkRemoteDBAvailability(),this.errors=[]}_checkRemoteDBAvailability(){return Boolean(this.dbDriver.accessToken)&&Boolean(this.dbDriver.userId)&&Boolean(this.dbDriver.requestsParams.headers)}async checkAndUpdate(e,t){let r=this.dbDriver.segmentsForUpdate,o=this.dbDriver.segmentsForMerge;Array.isArray(t)||(t=[t]);let s=!1,a=!1;for(let e of t)r.includes(e)&&(s=!0),o.includes(e)&&(a=!0);if(s){let t,r=[];return a&&(r=await this.query({wordItem:e})),t=r&&0!==r.length?this.dbDriver.mergeLocalRemote(r[0],e):e,await this.update(t),[t]}return[]}async create(e){try{let t=this.dbDriver.storageMap.post.url(e),o=this.dbDriver.storageMap.post.serialize(e),s=await r().post(t,o,this.dbDriver.requestsParams);return this.dbDriver.storageMap.post.checkResult(s)}catch(e){return e&&this.errors.push(e),!1}}async update(e){try{let t,o=this.dbDriver.storageMap.put.url(e);t=!e.constructor.name.match(/WordItem/)?e:this.dbDriver.storageMap.put.serialize(e);let s=await r().put(o,t,this.dbDriver.requestsParams);return this.dbDriver.storageMap.put.checkResult(s)}catch(e){return e&&this.errors.push(e),!1}}async deleteOne(e){try{let t=this.dbDriver.storageMap.deleteOne.url(e),o=await r().delete(t,this.dbDriver.requestsParams);return this.dbDriver.storageMap.deleteOne.checkResult(o)}catch(e){return e&&this.errors.push(e),!1}}async deleteMany(e){try{let t=this.dbDriver.storageMap.deleteMany.url(e),o=await r().delete(t,this.dbDriver.requestsParams);return this.dbDriver.storageMap.deleteMany.checkResult(o)}catch(e){return e&&this.errors.push(e),!1}}async query(e){try{let t=this.dbDriver.storageMap.get.url(e),o=await r().get(t,this.dbDriver.requestsParams);return this.dbDriver.storageMap.get.checkResult(o)}catch(e){let t=this.dbDriver.storageMap.get.checkErrorResult(e);return!t&&e&&e&&this.errors.push(e),"Request failed with status code 401"===e.message?[]:t}}}class UserDataManager{constructor(e,t){this.auth=e,this.subscriptions=[],t&&(this.subscriptions.push(t.WORDITEM_UPDATED.sub(this.update.bind(this))),this.subscriptions.push(t.WORDITEM_DELETED.sub(this.delete.bind(this))),this.subscriptions.push(t.WORDLIST_DELETED.sub(this.deleteMany.bind(this)))),this.blocked=!1,this.requestsQueue=[]}clear(){this.blocked&&e.Logger.getInstance().warn("Alpheios warn: destroying user data manager with requests pending. Words may not all be deleted.");for(let e of this.subscriptions)e();this.subscriptions=[]}_localStorageAdapter(e){let t=new UserDataManager.LOCAL_DRIVER_CLASSES[e](this.auth.userId);return new IndexedDBAdapter(t)}_remoteStorageAdapter(e){let t=new UserDataManager.REMOTE_DRIVER_CLASSES[e](this.auth);return new RemoteDBAdapter(t)}checkAdapters(e,t,r){let o=!1,s=!1;return"remote"===r.source?(o=!0,s=t.available):"local"===r.source?(o=e.available,s=!0):(o=e.available,s=t.available,e.available||this.printErrorAdapterUnvailable(e),t.available||this.printErrorAdapterUnvailable(t)),o&&s}printErrorAdapterUnvailable(t){e.Logger.getInstance().error(`Alpheios error: user data adapter is not available - ${t.constructor.name}`)}async update(t,r={}){if(this.blocked)this.requestsQueue.push({method:"update",data:t,params:r});else try{r.source=r.source||"both";let e=this.defineConstructorName(t.dataObj.constructor.name),o=this._localStorageAdapter(e),s=this._remoteStorageAdapter(e),a=!1,n=t.params&&t.params.segment?t.params.segment:o.dbDriver.segments;if(this.checkAdapters(o,s,r)){if(this.blocked=!0,"local"===r.source)a=await o.update(t.dataObj,t.params);else if("remote"===r.source)a=await s.update(t.dataObj,t.params);else{let e=await s.checkAndUpdate(t.dataObj,n);a=await o.checkAndUpdate(t.dataObj,n,e)}this.printErrors(s),this.printErrors(o),this.blocked=!1,this.checkRequestQueue()}return a}catch(t){e.Logger.getInstance().error("Alpheios error: unexpected error updating user data.",t)}}async delete(t,r={}){if(this.blocked)this.requestsQueue.push({method:"delete",data:t,params:r});else try{this.blocked=!0;let e=this.defineConstructorName(t.dataObj.constructor.name),o=this._localStorageAdapter(e),s=this._remoteStorageAdapter(e),a=!1,n=!1;return this.checkAdapters(o,s,r)&&(this.blocked=!0,a=!0,n=!0,"local"!==r.source&&(a=await s.deleteOne(t.dataObj)),"remote"!==r.source&&(n=await o.deleteOne(t.dataObj)),this.printErrors(s),this.printErrors(o),this.blocked=!1,this.checkRequestQueue()),a&&n}catch(t){e.Logger.getInstance().error("Alpheios error: unexpected error deleting user data.",t.message)}}async deleteMany(t,r={}){if(this.blocked)this.requestsQueue.push({method:"deleteMany",data:t,params:r});else try{let e=this._remoteStorageAdapter(t.dataType),o=this._localStorageAdapter(t.dataType),s=!1,a=!1;return this.checkAdapters(o,e,r)&&(s=!0,a=!0,this.blocked=!0,"local"!==r.source&&(a=await e.deleteMany(t.params)),"remote"!==r.source&&(s=await o.deleteMany(t.params)),this.printErrors(e),this.printErrors(o),this.blocked=!1,this.checkRequestQueue()),s&&a}catch(t){e.Logger.getInstance().error("Alpheios error: unexpected error deleting user data.",t.message)}}async query(t,r={}){try{r.type=r.type||"full",r.source=r.source||"both",r.syncDelete=r.syncDelete||!1;let e,o=this._remoteStorageAdapter(t.dataType),s=this._localStorageAdapter(t.dataType),a=[];if("local"===r.source)a=await s.query(t.params);else if("remote"===r.source){e=await o.query(t.params);for(let t of e)a.push(s.dbDriver.createFromRemoteData(t))}else{if(e=await o.query(t.params),"full"===r.type){for(let r of e){let e=s.dbDriver.createFromRemoteData(r);await s.checkAndUpdate(e,t.params.segment,[r])}a=await s.query(t.params)}else{e=await o.query(t.params);for(let t of e){let e=s.dbDriver.createFromRemoteData(t);a.push(e),s.checkAndUpdate(e,null,[t])}}r.syncDelete&&t.params.languageCode&&this.deleteAbsentInRemote(s,e,t.params.languageCode)}return this.printErrors(o),this.printErrors(s),a}catch(t){e.Logger.getInstance().error("Alpheios error: unexpected error querying user data.",t.message)}}async deleteAbsentInRemote(e,t,r){let o=await e.query({languageCode:r});for(let r of o){let o=e.dbDriver.makeIDCompareWithRemote(r);t.find((e=>e.ID===o))||this.delete({dataObj:r})}}printErrors(t){t.errors&&t.errors.length>0&&t.errors.forEach((t=>e.Logger.getInstance().error(`Alpheios error: user data unexpected error - ${t}`)))}checkRequestQueue(){if(this.requestsQueue.length>0){let e=this.requestsQueue.shift();this[e.method](e.data,e.params)}}defineConstructorName(e){let t,r=e.substr(0,1);if(r==r.toUpperCase())t=e;else{let r=e.split("_").length-1,o=e.replace("_","").toLowerCase().length/2;t=e.substr(-(o+r-2))}return t}}UserDataManager.LOCAL_DRIVER_CLASSES={WordItem:WordItemIndexedDbDriver},UserDataManager.REMOTE_DRIVER_CLASSES={WordItem:class WordItemRemoteDbDriver{constructor(e){this.accessToken=e.accessToken,this.userId=e.userId,this.requestsParams={baseURL:e.endpoints.wordlist,headers:{common:{Authorization:"bearer "+this.accessToken,"Content-Type":"application/json"}}},this.storageMap={post:{url:this._constructPostURL.bind(this),serialize:this._serialize.bind(this),checkResult:this._checkPostResult.bind(this)},put:{url:this._constructPostURL.bind(this),serialize:this._serializePut.bind(this),checkResult:this._checkPutResult.bind(this)},get:{url:this._constructGetURL.bind(this),checkResult:this._checkGetResult.bind(this),checkErrorResult:this._checkGetErrorResult.bind(this)},deleteOne:{url:this._constructPostURL.bind(this),checkResult:this._checkPutResult.bind(this)},deleteMany:{url:this._constructDeleteManyURL.bind(this),checkResult:this._checkPutResult.bind(this)}}}get segmentsForUpdate(){return["common","context","shortHomonym"]}get segmentsForMerge(){return["context"]}mergeLocalRemote(e,t){return e=this.mergeCommonPart(e,t),e=this.mergeHommonymPart(e,t),e=this.mergeContextPart(e,t)}mergeCommonPart(e,t){return e.important=e.important||t.important,e.frequency=e.frequency+t.frequency,e}mergeHommonymPart(e,t){if(!e.homonym){let r=this._serializeHomonym(t);r&&(e.homonym=r)}return e}mergeContextPart(t,r){let o=t.context||[];for(let s of r.context){t.context.some((t=>e.TextQuoteSelector.readObject(t).isEqual(s)))||o.push(this._serializeContextItem(s,t))}return t.context=o,t}_constructPostURL(e){return`/${this._makeStorageID(e)}`}_constructGetURL(e){return e.wordItem?`/${this._makeStorageID(e.wordItem)}`:e.languageCode?`/?languageCode=${e.languageCode}`:void 0}_constructDeleteManyURL(e){return`/?languageCode=${e.languageCode}`}_makeStorageID(e){return e.languageCode+"-"+e.targetWord}_serialize(e){let t={ID:this._makeStorageID(e),listID:this.userId+"-"+e.languageCode,userID:this.userId,languageCode:e.languageCode,targetWord:e.targetWord,important:e.important,createdDT:e.createdDT?e.createdDT:Utility.currentDate,updatedDT:e.updatedDT,frequency:e.frequency},r=this._serializeHomonym(e);null!==r&&(t.homonym=r);let o=this._serializeContext(e);return o&&o.length>0?t.context=o:t.context=[],t}_serializePut(e){let t=this._serialize(e);return t.updatedDT=e.updatedDT,t.frequency=e.frequency,t}_serializeHomonym(e){return e.homonym&&e.homonym.targetWord?{targetWord:e.homonym.targetWord,lemmasList:e.lemmasList}:null}_serializeContext(e){let t=[];for(let r of e.context)t.push(this._serializeContextItem(r,e));return t}_serializeContextItem(e,t){return{target:{source:e.source,selector:{type:"TextQuoteSelector",exact:e.text,prefix:e.prefix&&e.prefix.length>0?e.prefix:" ",suffix:e.suffix&&e.suffix.length>0?e.suffix:" ",languageCode:e.languageCode}},languageCode:t.languageCode,targetWord:t.targetWord,createdDT:Utility.currentDate}}_checkPostResult(e){return 201===e.status}_checkPutResult(e){return 200===e.status}_checkGetResult(e){return 200!==e.status?[]:Array.isArray(e.data)?e.data.map((e=>e.body?e.body:e)):[e.data]}_checkGetErrorResult(e){return!(!e.response||!e.response.data||"Item not found."!==e.response.data.error)&&[]}getCheckArray(e){return e.map((e=>this._makeStorageID(e)))}}}})(),o})()));